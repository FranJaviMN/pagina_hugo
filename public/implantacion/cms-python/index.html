<!DOCTYPE html>
<html lang="es-ES">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title> Cms Python | Blog</title>
  <meta name="description" content="En esta página estatica vamos a guardar algunos de los trabajos que vaya realizando a lo largo del curso de 2ºASIR en el instituto I.E.S. Gonzalo Nazareno.">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="robots" content="all,follow">
  <meta name="googlebot" content="index,follow,snippet,archive">
  <meta property="og:title" content="Cms Python" />
<meta property="og:description" content="Instalación de aplicación web python En esta tarea vamos a desplegar un CMS python. Para ello he elegido de la pagina https://djangopackages.org/grids/g/cms/ el cms llamado Mezzanine y lo vamos a desplegar en el entorno de produccion con uwsgi.
Creacion en el entorno de desarrollo Lo primero que debemos de hacer es desplegar nuestra aplicacion en nuestro entorno de desarrollo para asi, mediante un repositorio en github, podamos llevarnos todo el despliegue a nuestra maquina en desarrollo, en este caso va a ser la maquina Quijote." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://franjavimn.onrender.com/implantacion/cms-python/" />
<meta property="article:published_time" content="2021-01-22T20:22:10+01:00" />
<meta property="article:modified_time" content="2021-01-22T20:22:10+01:00" />

  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Cms Python"/>
<meta name="twitter:description" content="Instalación de aplicación web python En esta tarea vamos a desplegar un CMS python. Para ello he elegido de la pagina https://djangopackages.org/grids/g/cms/ el cms llamado Mezzanine y lo vamos a desplegar en el entorno de produccion con uwsgi.
Creacion en el entorno de desarrollo Lo primero que debemos de hacer es desplegar nuestra aplicacion en nuestro entorno de desarrollo para asi, mediante un repositorio en github, podamos llevarnos todo el despliegue a nuestra maquina en desarrollo, en este caso va a ser la maquina Quijote."/>

  
  
    
  
  
  <link rel="stylesheet" href="https://franjavimn.onrender.com/css/style-white.css">
  
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  

  
<link rel="icon" type="image/png" href="https://franjavimn.onrender.com/images/favicon.ico" />

  
</head>
<body class="max-width mx-auto px3 ltr">
  <div class="content index py4">

    <header id="header">
  <a href="https://franjavimn.onrender.com">
  
    <div id="logo" style="background-image: url(https://franjavimn.onrender.com/images/logo.png)"></div>
  
  <div id="title">
    <h1>Blog</h1>
  </div>
  </a>
  <div id="nav">
    <ul>
      <li class="icon">
        <a href="#"><i class="fas fa-bars fa-2x"></i></a>
      </li>
       
        <li><a href="/sistemas">Sistemas</a></li>
       
        <li><a href="/seguridad">Seguridad</a></li>
       
        <li><a href="/servicios">Servicios</a></li>
       
        <li><a href="/implantacion">Implantacion</a></li>
       
        <li><a href="/bbdd">BBDD</a></li>
       
        <li><a href="/hlc">HLC</a></li>
       
        <li><a href="/cloud">Cloud</a></li>
      
    </ul>
  </div>
</header>
  

    
<article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <div class="content" itemprop="articleBody">
  
    <h1 id="instalación-de-aplicación-web-python">Instalación de aplicación web python</h1>
<p>En esta tarea vamos a desplegar un CMS python. Para ello he elegido de la pagina <a href="https://djangopackages.org/grids/g/cms/">https://djangopackages.org/grids/g/cms/</a> el cms llamado <strong>Mezzanine</strong> y lo vamos a desplegar en el entorno de produccion con <strong>uwsgi</strong>.</p>
<h2 id="creacion-en-el-entorno-de-desarrollo">Creacion en el entorno de desarrollo</h2>
<p>Lo primero que debemos de hacer es desplegar nuestra aplicacion en nuestro entorno de desarrollo para asi, mediante un repositorio en github, podamos llevarnos todo el despliegue a nuestra maquina en desarrollo, en este caso va a ser la maquina <strong>Quijote</strong>.</p>
<p>Lo primero que debemos de hacer es crear un entorno virtual python en el cual vamos a estar instalando los paquetes necesarios para que no interfieran con los paquetes de nuestra maquina por lo que debemos de crear el entorno de desarrollo:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e">#### Instalamos los paquetes necesarios ####</span>
francisco@debian10:~$ sudo apt install python3-venv

<span style="color:#75715e">#### Creamos el entorno virtual ####</span>
francisco@debian10:~/Documentos/Implantacion/Python/practica-cms$ python3 -m venv mezzanine

<span style="color:#75715e">#### Iniciamos el entorno virtual ####</span>
francisco@debian10:~/Documentos/Implantacion/Python/practica-cms$ source mezzanine/bin/activate
<span style="color:#f92672">(</span>mezzanine<span style="color:#f92672">)</span> francisco@debian10:~/Documentos/Implantacion/Python/practica-cms$

<span style="color:#75715e">#### Instalamos el paquete llamado mezzanine ####</span>
<span style="color:#f92672">(</span>mezzanine<span style="color:#f92672">)</span> francisco@debian10:~/Documentos/Implantacion/Python/practica-cms$ pip install mezzanine

<span style="color:#75715e">#### Creamos un nuevo projecto de mezzanine ####</span>
<span style="color:#f92672">(</span>mezzanine<span style="color:#f92672">)</span> francisco@debian10:~/Documentos/Implantacion/Python/practica-cms$ mezzanine-project mezzanine_openstack

<span style="color:#75715e">#### Entramos en la carpeta del projecto y creamos la base de datos ####</span>
<span style="color:#f92672">(</span>mezzanine<span style="color:#f92672">)</span> francisco@debian10:~/Documentos/Implantacion/Python/practica-cms/mezzanine_openstack$ python3 manage.py createdb

<span style="color:#75715e">#### Corremos el servidor localmente ####</span>
<span style="color:#f92672">(</span>mezzanine<span style="color:#f92672">)</span> francisco@debian10:~/Documentos/Implantacion/Python/practica-cms/mezzanine_openstack$ python3 manage.py runserver
</code></pre></div><p>Hecho esto ya tenemos la aplicacion corriendo en nuestro equipo, para ver su contenido nos dirigimos a la url que nos indique en la consola, en mi caso http://localhost:8000/ y nos debe de salir algo como lo siguiente:</p>
<p><img src="https://raw.githubusercontent.com/FranJaviMN/elementos-grado/main/Implantacion/mezzanine/desarrollo-mezzanine.png" alt="imagen principal produccion"></p>
<h2 id="personalizando-la-pagina">Personalizando la pagina</h2>
<p>Ya que la tenemos lista en nuestro entorno de desarrollo, vamos a personalizar nuestra pagina y le vamos a cambiar el nombre a esta para ponerle el nuestro, para ello debemos de irnos a la zona de admin con url <a href="http://localhost:8000/admin/login/?next=/admin/">admin</a> y ahi ponemos las credenciales que anteriormente en el comando <strong>python3 manage.py createdb</strong> habiamos introducido por lo que entraremos en la zona de administracion:</p>
<p><img src="https://raw.githubusercontent.com/FranJaviMN/elementos-grado/main/Implantacion/mezzanine/admin-mezzanine-desarrollo.png" alt="zona de admin desarrollo"></p>
<p>Una vez ahi, debemos de irnos a la pestaña donde dice <strong>Settings</strong> y ahi debemos de buscar la zona donde pone <strong>Site</strong> y ahi tendremos dos campos, uno en el que viene una pequeña descripcion de la pagina y en la otra el nombre de la pagina. Lo editamos a nuestro gusto y volvemos a la pagina de inicio donde ya deberiamos de ver los cambios:</p>
<p><img src="https://raw.githubusercontent.com/FranJaviMN/elementos-grado/main/Implantacion/mezzanine/cambios-desarrollo-mezanine.png" alt="cambios en desarrollo"></p>
<p>Despues de esto debemos de realizar una copia de la base de datos para llevarnosla a nuestro entorno de produccion donde nosotros la cargaremos en nuestra base de datos <strong>mariadb</strong>, por lo que vamos a ejecutar la copia de la base de dtaos en el entorno de desarrollo:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e">#### Realizamos la copia de la base de datos ####</span>
<span style="color:#f92672">(</span>mezzanine<span style="color:#f92672">)</span> francisco@debian10:~/Documentos/Implantacion/Python/practica-cms/python-cms-mezzanine/mezzanine_openstack$ python manage.py dumpdata &gt; copia_db.json
</code></pre></div><p>Despues de esto solo debemos de llevarnoslo a nuestro repositorio de git:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e">#### Añadimos todos los ficheros que tenemos ####</span>
francisco@debian10:~/Documentos/Implantacion/Python/practica-cms/python-cms-mezzanine$ git add mezzanine_openstack/

<span style="color:#75715e">#### Añadimos los commits que deseemos y lo subimos al repositorio ####</span>
francisco@debian10:~/Documentos/Implantacion/Python/practica-cms/python-cms-mezzanine$ git push
</code></pre></div><h2 id="despliegue-en-produccion">Despliegue en produccion</h2>
<p>Para ello vamos a hacer primero los preparativos con la base de datos mariadb ya que, esta base de datos se encuentra en otra maquina, por lo que debemos de crear en nuestra maquina con la base de datos un usuario especifico para esta aplicacion que vamos a usar, en mi caso la maquina es <strong>Sancho</strong> y su ip es <strong>10.0.1.8</strong>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e">#### Creamos el usuario con una contraseña ####</span>
MariaDB <span style="color:#f92672">[(</span>none<span style="color:#f92672">)]</span>&gt; CREATE USER <span style="color:#e6db74">&#39;mezzanine&#39;</span>@<span style="color:#e6db74">&#39;10.0.2.3&#39;</span> IDENTIFIED BY <span style="color:#e6db74">&#39;mezzanine&#39;</span>;
Query OK, <span style="color:#ae81ff">0</span> rows affected <span style="color:#f92672">(</span>0.100 sec<span style="color:#f92672">)</span>
</code></pre></div><p>Una vez hecho esto debemos de asegurarnos de que nuestra base de datos mariadb es capaz de ser accedida desde la ip donde tenemos nuestra aplicacion, por lo que debemos de dirigirnos a nuestro fichero de configuracion <strong>/etc/mysql/mariadb.conf.d/50-server.cnf</strong> y vemos que la linea <em>bind-address</em> esta de la siguiente forma:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e">#### Comprobamos que esta correcto ####</span>
bind-address            <span style="color:#f92672">=</span> 0.0.0.0

<span style="color:#75715e">#### Reiniciamos el servicios de mariadb ####</span>
root@sancho:~# systemctl restart mariadb
</code></pre></div><p>De esta forma ya tendremos la base de datos accesible desde nuestra maquina <strong>quijote</strong>, por lo que vamos a hacer una prueba desde quijote para ver que podemos acceder, aunque debemos de tener en cuenta que tenemos que tener instalado un paquete llamado mariadb para poder realizar la conexion a la base de datos remota:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e">#### Instalamos (si no lo tuvieramos) el paquete mariadb ####</span>
<span style="color:#f92672">[</span>centos@quijote ~<span style="color:#f92672">]</span>$ sudo dnf install mariadb

<span style="color:#75715e">#### Hacemos la comprobacion ####</span>
<span style="color:#f92672">[</span>root@quijote ~<span style="color:#f92672">]</span><span style="color:#75715e"># mysql -u mezzanine -p -h bd.franjavier.gonzalonazareno.org</span>
Enter password: 
Welcome to the MariaDB monitor.  Commands end with ; or <span style="color:#ae81ff">\g</span>.
Your MariaDB connection id is <span style="color:#ae81ff">37</span>
Server version: 10.3.25-MariaDB-0ubuntu0.20.04.1 Ubuntu 20.04

Copyright <span style="color:#f92672">(</span>c<span style="color:#f92672">)</span> 2000, 2018, Oracle, MariaDB Corporation Ab and others.

Type <span style="color:#e6db74">&#39;help;&#39;</span> or <span style="color:#e6db74">&#39;\h&#39;</span> <span style="color:#66d9ef">for</span> help. Type <span style="color:#e6db74">&#39;\c&#39;</span> to clear the current input statement.

MariaDB <span style="color:#f92672">[(</span>none<span style="color:#f92672">)]</span>&gt; 
</code></pre></div><p>Vemos que sin problemas hemos podido conectar, por lo que ya podemos seguir con el despliegue en produccion.</p>
<h2 id="instalacion-de-paquetes-necesarios">Instalacion de paquetes necesarios</h2>
<p>Antes de seguir debemos de instalar algunos paquetes que nos haran falta para poder poner nuestra aplicacion en produccion, para ello debemos de tener instalado <strong>python3-venv</strong> para poder crear el entorno virtual de python, debemos de tener instalado <strong>uwsgi</strong> que es el servidor de aplicaciones que usaremos junto a apache2 para servir nuestra pagina y tambien debemos de instalar el conector con la base de datos que es <strong>python3-mysqldb</strong>. Si no fueran suficientes, mas adelante indicare los paquetes que debemos de tener instalados ya que iremos paso a paso.</p>
<p>Primero necesitamos nuestro repositorio, por lo que vamos a instalar el paquete llamado <strong>git</strong> y clonamos el repositorio via https:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e">#### Instalamos el paquete git ####</span>
<span style="color:#f92672">[</span>centos@quijote ~<span style="color:#f92672">]</span>$ sudo dnf install git

<span style="color:#75715e">#### Clonamos el repositorio en /var/www/ ####</span>
<span style="color:#f92672">[</span>centos@quijote www<span style="color:#f92672">]</span>$ sudo git clone https://github.com/FranJaviMN/python-cms-mezzanine.git
</code></pre></div><p>Una vez ya tengamos clonado el repositorio podemos seguir con nuestro despliegue.</p>
<p>Hecho esto ahora vamos a crear nuestro entorno virtual con python3-venv por lo que lo vamos a llamar mezzanine:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e">#### Creamos el entorno virtual ####</span>
<span style="color:#f92672">[</span>centos@quijote ~<span style="color:#f92672">]</span>$ python3 -m venv mezzanine

<span style="color:#75715e">#### Entramos en el entorno virtual y copiamos los paquetes del fichero requirement.txt ####</span>
<span style="color:#f92672">(</span>mezzanine<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>centos@quijote ~<span style="color:#f92672">]</span>$ pip install -r /var/www/python-cms-mezzanine/mezzanine_openstack/requirements.txt
</code></pre></div><p>Una vez hecho esto tendremos los mismos paquetes instalados en el entorno de produccion como en el entorno de desarrollo. Ahora necesitamos varios paquetes, priemro el paquete que permite a apache2 ejecutar codigo pyhton, segundo debemos de instalar el modulo para que python trabaje con mariadb y luego, en el entorno virtual debemos de instalar el conector:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e">#### Instalamos el modulo de wsgi ####</span>
<span style="color:#f92672">[</span>centos@quijote ~<span style="color:#f92672">]</span>$ sudo dnf install python3-mod_wsgi

<span style="color:#75715e">#### Instalamos en el entorno virtual el conector ####</span>
<span style="color:#f92672">(</span>mezzanine<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>centos@quijote ~<span style="color:#f92672">]</span>$ pip install mysql-connector-python

<span style="color:#75715e">#### Instalamos el paquete de uwsgi con pip ####</span>

Antes debemos de tener instalados en nuestra maquina los siguientes paquetes:

<span style="color:#f92672">[</span>centos@quijote ~<span style="color:#f92672">]</span>$ sudo dnf install gcc python3-devel

<span style="color:#75715e"># Ahora si instalamos con pip</span>

<span style="color:#f92672">(</span>mezzanine<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>centos@quijote ~<span style="color:#f92672">]</span>$ pip install uwsgi
</code></pre></div><p>Ahora si nosotros intentamos ejecutar <strong>uwsgi</strong> veremos que se ejecuta sin problemas, en mi caso vamos a ejecutar el cms llamado mezzanine:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e">#### Desde el entorno virtual ejecutamos uwsgi ####</span>
<span style="color:#f92672">(</span>mezzanine<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>centos@quijote ~<span style="color:#f92672">]</span>$ mezzanine/bin/uwsgi --http <span style="color:#ae81ff">8080</span> --plugin python35 --chdir /var/www/python-cms-mezzanine/mezzanine_openstack/ --wsgi-file /var/www/python-cms-mezzanine/mezzanine_openstack/mezzanine_openstack/wsgi.py --process <span style="color:#ae81ff">4</span> --threads <span style="color:#ae81ff">2</span> --master

<span style="color:#75715e">#### Nos debe salir de la siguiente manera ####</span>
!!! UNABLE to load uWSGI plugin: ./python35_plugin.so: cannot open shared object file: No such file or directory !!!
*** Starting uWSGI 2.0.19.1 <span style="color:#f92672">(</span>64bit<span style="color:#f92672">)</span> on <span style="color:#f92672">[</span>Wed Jan <span style="color:#ae81ff">20</span> 09:27:22 2021<span style="color:#f92672">]</span> ***
compiled with version: 8.3.1 <span style="color:#ae81ff">20191121</span> <span style="color:#f92672">(</span>Red Hat 8.3.1-5<span style="color:#f92672">)</span> on <span style="color:#ae81ff">19</span> January <span style="color:#ae81ff">2021</span> 11:18:26
os: Linux-4.18.0-240.1.1.el8_3.x86_64 <span style="color:#75715e">#1 SMP Thu Nov 19 17:20:08 UTC 2020</span>
nodename: quijote
machine: x86_64
clock source: unix
detected number of CPU cores: <span style="color:#ae81ff">1</span>
current working directory: /home/centos
detected binary path: /home/centos/mezzanine/bin/uwsgi
!!! no internal routing support, rebuild with pcre support !!!
chdir<span style="color:#f92672">()</span> to /var/www/python-cms-mezzanine/mezzanine_openstack/
your processes number limit is <span style="color:#ae81ff">1647</span>
your memory page size is <span style="color:#ae81ff">4096</span> bytes
detected max file descriptor number: <span style="color:#ae81ff">1024</span>
lock engine: pthread robust mutexes
thunder lock: disabled <span style="color:#f92672">(</span>you can enable it with --thunder-lock<span style="color:#f92672">)</span>
uWSGI http bound on <span style="color:#ae81ff">8080</span> fd <span style="color:#ae81ff">4</span>
uwsgi socket <span style="color:#ae81ff">0</span> bound to TCP address 127.0.0.1:39089 <span style="color:#f92672">(</span>port auto-assigned<span style="color:#f92672">)</span> fd <span style="color:#ae81ff">3</span>
Python version: 3.6.8 <span style="color:#f92672">(</span>default, Aug <span style="color:#ae81ff">24</span> 2020, 17:57:11<span style="color:#f92672">)</span>  <span style="color:#f92672">[</span>GCC 8.3.1 <span style="color:#ae81ff">20191121</span> <span style="color:#f92672">(</span>Red Hat 8.3.1-5<span style="color:#f92672">)]</span>
Python main interpreter initialized at 0xbed860
python threads support enabled
your server socket listen backlog is limited to <span style="color:#ae81ff">100</span> connections
your mercy <span style="color:#66d9ef">for</span> graceful operations on workers is <span style="color:#ae81ff">60</span> seconds
mapped <span style="color:#ae81ff">416720</span> bytes <span style="color:#f92672">(</span><span style="color:#ae81ff">406</span> KB<span style="color:#f92672">)</span> <span style="color:#66d9ef">for</span> <span style="color:#ae81ff">8</span> cores
*** Operational MODE: preforking+threaded ***
WSGI app <span style="color:#ae81ff">0</span> <span style="color:#f92672">(</span>mountpoint<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;&#39;</span><span style="color:#f92672">)</span> ready in <span style="color:#ae81ff">2</span> seconds on interpreter 0xbed860 pid: <span style="color:#ae81ff">19143</span> <span style="color:#f92672">(</span>default app<span style="color:#f92672">)</span>
*** uWSGI is running in multiple interpreter mode ***
spawned uWSGI master process <span style="color:#f92672">(</span>pid: 19143<span style="color:#f92672">)</span>
spawned uWSGI worker <span style="color:#ae81ff">1</span> <span style="color:#f92672">(</span>pid: 19145, cores: 2<span style="color:#f92672">)</span>
spawned uWSGI worker <span style="color:#ae81ff">2</span> <span style="color:#f92672">(</span>pid: 19146, cores: 2<span style="color:#f92672">)</span>
spawned uWSGI worker <span style="color:#ae81ff">3</span> <span style="color:#f92672">(</span>pid: 19147, cores: 2<span style="color:#f92672">)</span>
spawned uWSGI worker <span style="color:#ae81ff">4</span> <span style="color:#f92672">(</span>pid: 19148, cores: 2<span style="color:#f92672">)</span>
spawned uWSGI http <span style="color:#ae81ff">1</span> <span style="color:#f92672">(</span>pid: 19149<span style="color:#f92672">)</span>

<span style="color:#75715e">#### Para cancelar solo usamos Ctrl+c ####</span>
^CSIGINT/SIGQUIT received...killing workers...
gateway <span style="color:#e6db74">&#34;uWSGI http 1&#34;</span> has been buried <span style="color:#f92672">(</span>pid: 19149<span style="color:#f92672">)</span>
worker <span style="color:#ae81ff">1</span> buried after <span style="color:#ae81ff">1</span> seconds
worker <span style="color:#ae81ff">2</span> buried after <span style="color:#ae81ff">1</span> seconds
worker <span style="color:#ae81ff">3</span> buried after <span style="color:#ae81ff">1</span> seconds
worker <span style="color:#ae81ff">4</span> buried after <span style="color:#ae81ff">1</span> seconds
goodbye to uWSGI.
</code></pre></div><h2 id="conexion-con-la-base-de-datos">Conexion con la base de datos</h2>
<p>Para ello debemos de tener en cuenta que la base de datos se encuentra en otra maquina y en otra red, mas concretamente en la maquina sancho por lo que debemos de asegurarnos que nos podemos conectar a ella sin problemas como hemos visto al principio del post.</p>
<p>Ahora debemos de crear una nueva base de datos en la que vamos copiar las tablas que necesitamos para poder seguir con el ejercicio por lo que nos dirigimos a nuestra maquina <strong>Sancho</strong> y ahi vamos a crear la base de datos llamada <strong>mezzanine</strong> y le vamos a dar al usuario <strong>mezzanine</strong> los privilegios necesarios para poder interactuar con esa tabla, por lo que hacemos lo siguiente:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e">#### Creamos nuestra nueva tabla ####</span>
MariaDB <span style="color:#f92672">[(</span>none<span style="color:#f92672">)]</span>&gt; create database mezzanine;

<span style="color:#75715e">#### Le damos los privilegios necesarios al usuario mezzanine ####</span>
MariaDB <span style="color:#f92672">[(</span>none<span style="color:#f92672">)]</span>&gt; GRANT ALL privileges ON <span style="color:#e6db74">`</span>mezzanine<span style="color:#e6db74">`</span>.* TO <span style="color:#e6db74">&#39;mezzanine&#39;</span>@<span style="color:#e6db74">&#39;10.0.2.3&#39;</span>;
</code></pre></div><p>De esta forma, desde nuestra maquina vamos a conectarnos a la base de datos y vamos a usar la base de datos que hemos creado para ver si funciona correctamente:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e">#### Nos conectamos remotamente ####</span>
<span style="color:#f92672">[</span>centos@quijote ~<span style="color:#f92672">]</span>$ mysql -u mezzanine -p -h bd.franjavier.gonzalonazareno.org
Enter password: 
Welcome to the MariaDB monitor.  Commands end with ; or <span style="color:#ae81ff">\g</span>.
Your MariaDB connection id is <span style="color:#ae81ff">53</span>
Server version: 10.3.25-MariaDB-0ubuntu0.20.04.1 Ubuntu 20.04

Copyright <span style="color:#f92672">(</span>c<span style="color:#f92672">)</span> 2000, 2018, Oracle, MariaDB Corporation Ab and others.

Type <span style="color:#e6db74">&#39;help;&#39;</span> or <span style="color:#e6db74">&#39;\h&#39;</span> <span style="color:#66d9ef">for</span> help. Type <span style="color:#e6db74">&#39;\c&#39;</span> to clear the current input statement.

MariaDB <span style="color:#f92672">[(</span>none<span style="color:#f92672">)]</span>&gt; 

<span style="color:#75715e">#### Usamos la nueva base de datos que hemos creado ####</span>
MariaDB <span style="color:#f92672">[(</span>none<span style="color:#f92672">)]</span>&gt; use mezzanine
Reading table information <span style="color:#66d9ef">for</span> completion of table and column names
You can turn off this feature to get a quicker startup with -A

Database changed
MariaDB <span style="color:#f92672">[</span>mezzanine<span style="color:#f92672">]</span>&gt; 
</code></pre></div><p>Como vemos funciona correctamente por lo que podemos seguir con la copia de la base de datos a mysql, para ello nos dirigimos al fichero de <strong>mezzanine</strong> que se llama <strong>settings.py</strong> y ahi buscamos el apartado llamado <strong>DATABASES</strong> y debemos de añadirle las credenciales de la base de datos asi como su ip y el puerto que usa:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">DATABASES <span style="color:#f92672">=</span> {
    <span style="color:#e6db74">&#34;default&#34;</span>: {
        <span style="color:#75715e"># Add &#34;postgresql_psycopg2&#34;, &#34;mysql&#34;, &#34;sqlite3&#34; or &#34;oracle&#34;.</span>
        <span style="color:#e6db74">&#34;ENGINE&#34;</span>: <span style="color:#e6db74">&#34;django.db.backends.mysql&#34;</span>,
        <span style="color:#75715e"># DB name or path to database file if using sqlite3.</span>
        <span style="color:#e6db74">&#34;NAME&#34;</span>: <span style="color:#e6db74">&#34;mezzanine&#34;</span>,
        <span style="color:#75715e"># Not used with sqlite3.</span>
        <span style="color:#e6db74">&#34;USER&#34;</span>: <span style="color:#e6db74">&#34;mezzanine&#34;</span>,
        <span style="color:#75715e"># Not used with sqlite3.</span>
        PASSWORD<span style="color:#e6db74">&#34;: &#34;</span>contraseña<span style="color:#f92672">-</span><span style="color:#66d9ef">del</span><span style="color:#f92672">-</span>usuario<span style="color:#e6db74">&#34;,</span>
        <span style="color:#75715e"># Set to empty string for localhost. Not used with sqlite3.</span>
        <span style="color:#e6db74">&#34;HOST&#34;</span>: <span style="color:#e6db74">&#34;10.0.1.8&#34;</span>,
        <span style="color:#75715e"># Set to empty string for default. Not used with sqlite3.</span>
        <span style="color:#e6db74">&#34;PORT&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>,
    }
}
</code></pre></div><p>Asi ya tendremos la base de datos asignada por lo que vamos a proceder a copiar los datos a la base de datos, para ello debemos de usar el entorno virtual de python y ejecutar el siguiente comando:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e">#### Usamos el entorno virtual ####</span>
<span style="color:#f92672">[</span>centos@quijote ~<span style="color:#f92672">]</span>$ source mezzanine/bin/activate

<span style="color:#75715e">#### Creamos la migracion a la base de datos remota ####</span>
<span style="color:#f92672">(</span>mezzanine<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>centos@quijote mezzanine_openstack<span style="color:#f92672">]</span>$ python manage.py migrate

<span style="color:#75715e">#### Cargamos los datos que hemos recolectado con copia_db.json ####</span>
<span style="color:#f92672">(</span>mezzanine<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>centos@quijote mezzanine_openstack<span style="color:#f92672">]</span>$ python manage.py loaddata copia_db.json
</code></pre></div><p>De esta forma ya tenemos toda la informacion en una base de datos mariadb que se encuentra en otra maquina.</p>
<h2 id="despliegue-del-cms-en-apache2">Despliegue del CMS en apache2</h2>
<p>Para ello debemos de tener ya instalado apache2 en nuestra maquina, recalco que la maquina es <strong>centos8</strong> por lo que la instalacion de apache2 cambia un poco, pero puedes ver como lo instale en el siguiente <a href="https://franjavimn.onrender.com/servicios/trabajo-openstack/">documento</a>.</p>
<p>Cuadno lo tengamos instalado lo que vamos a hacer es formar un nuevo virtualhost el cual vamos a llamar <strong>mezzanine.conf</strong> el cual va a tener solo la siguiente información:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">&lt;VirtualHost *:80&gt;
    ServerName python.franjavier.gonzalonazareno.org
    DocumentRoot /var/www/python-cms-mezzanine/mezzanine_openstack
    ErrorLog /var/www/python-cms-mezzanine/log/error.log
    CustomLog /var/www/python-cms-mezzanine/log/requests.log combined
	
    &lt;Proxy <span style="color:#e6db74">&#34;unix:/run/php-fpm/www.sock|fcgi://php-fpm&#34;</span>&gt;
    ProxySet disablereuse<span style="color:#f92672">=</span>off
    &lt;/Proxy&gt;

    &lt;FilesMatch <span style="color:#ae81ff">\.</span>php$&gt;
           SetHandler proxy:fcgi://php-fpm
    &lt;/FilesMatch&gt;

    Redirect permanent / https://python.franjavier.gonzalonazareno.org
</code></pre></div><p>Donde vamos a tener nuestro fichero con la redireccion hacia <strong>https</strong>, por lo que tendremos un fichero llamado <strong>mezzanine-https.conf</strong> con la siguiente configuración:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">&lt;VirtualHost *:443&gt;
    ServerName python.franjavier.gonzalonazareno.org
    DocumentRoot /var/www/python-cms-mezzanine/mezzanine_openstack
    ErrorLog /var/www/python-cms-mezzanine/log/error.log
    CustomLog /var/www/python-cms-mezzanine/log/requests.log combined
	
    &lt;Proxy <span style="color:#e6db74">&#34;unix:/run/php-fpm/www.sock|fcgi://php-fpm&#34;</span>&gt;
    ProxySet disablereuse<span style="color:#f92672">=</span>off
    &lt;/Proxy&gt;

    &lt;FilesMatch <span style="color:#ae81ff">\.</span>php$&gt;
           SetHandler proxy:fcgi://php-fpm
    &lt;/FilesMatch&gt;

    Alias /static <span style="color:#e6db74">&#34;/var/www/python-cms-mezzanine/mezzanine_openstack/static&#34;</span>
    
    &lt;Directory /var/www/python-cms-mezzanine/mezzanine_openstack/static&gt;
    Require all granted
    Options FollowSymlinks
    &lt;/Directory&gt; 
    ProxyPass /static !
    ProxyPass / http://127.0.0.1:8080/

    SSLEngine on
    SSLCertificateFile /etc/pki/tls/certs/wildcard-franjavier.crt
    SSLCertificateKeyFile /etc/pki/tls/private/wildcard.key

&lt;/VirtualHost&gt;
</code></pre></div><p>Donde vemos que vamos a usar como proxy nuestro apache como proxy inverso, por lo que vamos a usar uwsgi y vamos a usar el puerto <strong>http :8080</strong>, por lo que le indicamos como va a hacer el proxy y en que puerto. La opcion que estamos añadiendo de <strong>ProxyPass /static !</strong> nos sirve para que, la carpeta de static no pase por el proxy para asi poder servir adecuadamente los ficheros estaticos. De tal forma que si reinciamos el servicio de apache debe de ir bien.</p>
<p>Ahora necesitamos iniciar el proxy con uwsgi, para ell podemos, o bien usar un fichero <strong>.ini</strong> o un comando, para este vamos a usar un fichero .ini:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e">#### Fichero uwsgi.ini ####</span>
<span style="color:#f92672">[</span>uwsgi<span style="color:#f92672">]</span>
http <span style="color:#f92672">=</span> :8080
chdir <span style="color:#f92672">=</span> /var/www/python-cms-mezzanine/mezzanine_openstack 
wsgi-file <span style="color:#f92672">=</span> /var/www/python-cms-mezzanine/mezzanine_openstack/mezzanine_openstack/wsgi.py
master
</code></pre></div><p>Lo inciamos y veremos lo siguiente:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#f92672">(</span>mezzanine<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>centos@quijote ~<span style="color:#f92672">]</span>$ uwsgi uwsgi.ini 
<span style="color:#f92672">[</span>uWSGI<span style="color:#f92672">]</span> getting INI configuration from uwsgi.ini
*** Starting uWSGI 2.0.19.1 <span style="color:#f92672">(</span>64bit<span style="color:#f92672">)</span> on <span style="color:#f92672">[</span>Mon Jan <span style="color:#ae81ff">25</span> 10:37:57 2021<span style="color:#f92672">]</span> ***
compiled with version: 8.3.1 <span style="color:#ae81ff">20191121</span> <span style="color:#f92672">(</span>Red Hat 8.3.1-5<span style="color:#f92672">)</span> on <span style="color:#ae81ff">19</span> January <span style="color:#ae81ff">2021</span> 11:18:26
os: Linux-4.18.0-240.1.1.el8_3.x86_64 <span style="color:#75715e">#1 SMP Thu Nov 19 17:20:08 UTC 2020</span>
nodename: quijote
machine: x86_64
clock source: unix
detected number of CPU cores: <span style="color:#ae81ff">1</span>
current working directory: /home/centos
detected binary path: /home/centos/mezzanine/bin/uwsgi
!!! no internal routing support, rebuild with pcre support !!!
chdir<span style="color:#f92672">()</span> to /var/www/python-cms-mezzanine/mezzanine_openstack
your processes number limit is <span style="color:#ae81ff">1647</span>
your memory page size is <span style="color:#ae81ff">4096</span> bytes
detected max file descriptor number: <span style="color:#ae81ff">1024</span>
lock engine: pthread robust mutexes
thunder lock: disabled <span style="color:#f92672">(</span>you can enable it with --thunder-lock<span style="color:#f92672">)</span>
uWSGI http bound on :8080 fd <span style="color:#ae81ff">4</span>
uwsgi socket <span style="color:#ae81ff">0</span> bound to TCP address 127.0.0.1:35777 <span style="color:#f92672">(</span>port auto-assigned<span style="color:#f92672">)</span> fd <span style="color:#ae81ff">3</span>
Python version: 3.6.8 <span style="color:#f92672">(</span>default, Aug <span style="color:#ae81ff">24</span> 2020, 17:57:11<span style="color:#f92672">)</span>  <span style="color:#f92672">[</span>GCC 8.3.1 <span style="color:#ae81ff">20191121</span> <span style="color:#f92672">(</span>Red Hat 8.3.1-5<span style="color:#f92672">)]</span>
*** Python threads support is disabled. You can enable it with --enable-threads ***
Python main interpreter initialized at 0x139f470
your server socket listen backlog is limited to <span style="color:#ae81ff">100</span> connections
your mercy <span style="color:#66d9ef">for</span> graceful operations on workers is <span style="color:#ae81ff">60</span> seconds
mapped <span style="color:#ae81ff">145808</span> bytes <span style="color:#f92672">(</span><span style="color:#ae81ff">142</span> KB<span style="color:#f92672">)</span> <span style="color:#66d9ef">for</span> <span style="color:#ae81ff">1</span> cores
*** Operational MODE: single process ***
WSGI app <span style="color:#ae81ff">0</span> <span style="color:#f92672">(</span>mountpoint<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;&#39;</span><span style="color:#f92672">)</span> ready in <span style="color:#ae81ff">1</span> seconds on interpreter 0x139f470 pid: <span style="color:#ae81ff">44150</span> <span style="color:#f92672">(</span>default app<span style="color:#f92672">)</span>
*** uWSGI is running in multiple interpreter mode ***
spawned uWSGI master process <span style="color:#f92672">(</span>pid: 44150<span style="color:#f92672">)</span>
spawned uWSGI worker <span style="color:#ae81ff">1</span> <span style="color:#f92672">(</span>pid: 44152, cores: 1<span style="color:#f92672">)</span>
spawned uWSGI http <span style="color:#ae81ff">1</span> <span style="color:#f92672">(</span>pid: 44153<span style="color:#f92672">)</span>
</code></pre></div><h2 id="entrando-en-nuestro-sitio-web">Entrando en nuestro sitio web</h2>
<p>Para ello debemos de irnos a nuestro servidor DNS para poder añadirle nuestro nuevo virtualhost, por lo que en la vista externa de nuestro servidor DNS debemos de poner una opcion <strong>CNAME</strong> de python hacia nuestra maquina <strong>Dulcinea</strong>, una vez hecho si nos dirigimos a nuestro navegador y entramos en <strong>python.franjavier.gonzalonazareno.org</strong> y debe de salirnos la siguiente pagina:</p>
<p><img src="https://raw.githubusercontent.com/FranJaviMN/elementos-grado/main/Implantacion/mezzanine/mezzanine-pagina.png" alt="pagina mezzanine"></p>
<p>Y esta en nuestra pagina de admin, que vemos que se sirven bien los ficheros:</p>
<p><img src="https://raw.githubusercontent.com/FranJaviMN/elementos-grado/main/Implantacion/mezzanine/mezzanine-pagina-admin.png" alt="pagina admin mezzanine"></p>

  
  </div>
</article>


    <footer id="footer">
  <div class="footer-left">
    Copyright  &copy; 2021  Francisco Javier Martín Núñez 
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
        <li><a href="/sistemas">Sistemas</a></li>
         
        <li><a href="/seguridad">Seguridad</a></li>
         
        <li><a href="/servicios">Servicios</a></li>
         
        <li><a href="/implantacion">Implantacion</a></li>
         
        <li><a href="/bbdd">BBDD</a></li>
         
        <li><a href="/hlc">HLC</a></li>
         
        <li><a href="/cloud">Cloud</a></li>
        
      </ul>
    </nav>
  </div>
</footer>


  </div>
  
</body>

<link rel="stylesheet" href=/lib/font-awesome/css/all.min.css>
<script src=/lib/jquery/jquery.min.js></script>
<script src=/js/main.js></script>
</html>
