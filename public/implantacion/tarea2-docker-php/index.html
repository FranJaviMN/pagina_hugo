<!DOCTYPE html>
<html lang="es-ES">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title> Tarea2 Docker Php | Blog</title>
  <meta name="description" content="En esta página estatica vamos a guardar algunos de los trabajos que vaya realizando a lo largo del curso de 2ºASIR en el instituto I.E.S. Gonzalo Nazareno.">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="robots" content="all,follow">
  <meta name="googlebot" content="index,follow,snippet,archive">
  <meta property="og:title" content="Tarea2 Docker Php" />
<meta property="og:description" content="Repositorio git: https://github.com/FranJaviMN/Docker-php/tree/main/Tarea%202
Tarea 2: Ejecución de una aplicación web PHP en docker   Realiza la imagen docker de la aplicación a partir de la imagen oficial PHP que encuentras en docker hub. Lee la documentación de la imagen para configurar una imagen con apache2 y php, además seguramente tengas que instalar alguna extensión de php.
  Crea esta imagen en docker hub
  Crea un script con docker compose que levante el escenario con los dos contenedores." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://franjavimn.onrender.com/implantacion/tarea2-docker-php/" /><meta property="article:section" content="Implantacion" />
<meta property="article:published_time" content="2021-03-02T10:33:38+01:00" />
<meta property="article:modified_time" content="2021-03-02T10:33:38+01:00" />


  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Tarea2 Docker Php"/>
<meta name="twitter:description" content="Repositorio git: https://github.com/FranJaviMN/Docker-php/tree/main/Tarea%202
Tarea 2: Ejecución de una aplicación web PHP en docker   Realiza la imagen docker de la aplicación a partir de la imagen oficial PHP que encuentras en docker hub. Lee la documentación de la imagen para configurar una imagen con apache2 y php, además seguramente tengas que instalar alguna extensión de php.
  Crea esta imagen en docker hub
  Crea un script con docker compose que levante el escenario con los dos contenedores."/>

  
  
    
  
  
  <link rel="stylesheet" href="https://franjavimn.onrender.com/css/style-light.css">
  
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  

  
<link rel="icon" type="image/png" href="https://franjavimn.onrender.com/images/favicon.ico" />

  
</head>
<body class="max-width mx-auto px3 ltr">
  <div class="content index py4">

    <header id="header">
  <a href="https://franjavimn.onrender.com">
  
    <div id="logo" style="background-image: url(https://franjavimn.onrender.com/images/logo.png)"></div>
  
  <div id="title">
    <h1>Blog</h1>
  </div>
  </a>
  <div id="nav">
    <ul>
      <li class="icon">
        <a href="#"><i class="fas fa-bars fa-2x"></i></a>
      </li>
       
        <li><a href="/sistemas">Sistemas</a></li>
       
        <li><a href="/seguridad">Seguridad</a></li>
       
        <li><a href="/servicios">Servicios</a></li>
       
        <li><a href="/implantacion">Implantacion</a></li>
       
        <li><a href="/bbdd">BBDD</a></li>
       
        <li><a href="/hlc">HLC</a></li>
       
        <li><a href="/proyecto-podman">Proyecto Podman</a></li>
      
    </ul>
  </div>
</header>
  

    
<article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <div class="content" itemprop="articleBody">
  
    <p><strong>Repositorio git: <a href="https://github.com/FranJaviMN/Docker-php/tree/main/Tarea%202">https://github.com/FranJaviMN/Docker-php/tree/main/Tarea%202</a></strong></p>
<h1 id="tarea-2-ejecución-de-una-aplicación-web-php-en-docker">Tarea 2: Ejecución de una aplicación web PHP en docker</h1>
<ul>
<li>
<p>Realiza la imagen docker de la aplicación a partir de la imagen oficial PHP que encuentras en docker hub. Lee la documentación de la imagen para configurar una imagen con apache2 y php, además seguramente tengas que instalar alguna extensión de php.</p>
</li>
<li>
<p>Crea esta imagen en docker hub</p>
</li>
<li>
<p>Crea un script con docker compose que levante el escenario con los dos contenedores.</p>
</li>
</ul>
<p>Para ello vamos a seguir los mismo pasos que hemos seguido en el ejercicio 1, primero lo que vamos a hacer es irnos a la documentación de la imagen de php que tenemos en <a href="https://hub.docker.com/_/php/">DockerHub</a></p>
<p>Una vez la hayamos leido vamos a generar, en primer lugar nuestra nuevo <strong>Dockerfile</strong></p>
<h2 id="generando-nueva-imagen">Generando nueva imagen</h2>
<p>Vamos a generar una imagen a partir de la imagen de <strong>php:7.4-apache</strong> para poder hacer lo que hicimos en el ejercicio 1 pero esta vez con otra imagen, por lo que vamos a generar la imagen con el siguiente fichero de <strong>Dockerfile</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-dockerfile" data-lang="dockerfile"><span style="color:#66d9ef">FROM</span><span style="color:#e6db74"> php:7.4-apache</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> docker-php-ext-install pdo pdo_mysql mysqli json<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> a2enmod rewrite<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">ENV</span> DATABASE_USER<span style="color:#f92672">=</span>bookmedik
<span style="color:#66d9ef">ENV</span> DATABASE_PASSWORD<span style="color:#f92672">=</span>bookmedik
<span style="color:#66d9ef">ENV</span> DATABASE_HOST<span style="color:#f92672">=</span>db

<span style="color:#66d9ef">EXPOSE</span><span style="color:#e6db74"> 80</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">WORKDIR</span><span style="color:#e6db74"> /var/www/html</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">COPY</span> ./bookmedik /var/www/html<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">ADD</span> script.sh /usr/local/bin/script.sh<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> chmod +x /usr/local/bin/script.sh<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">CMD</span> [<span style="color:#e6db74">&#34;/usr/local/bin/script.sh&#34;</span>]<span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><p>Debemos de tener en cuenta que ahora nuestro nuevo fichero de <em>script.sh</em> es el mismo que en el ejercicio 1, ya que vamos a desplegar la aplicación de <strong>bookmedik</strong> por lo que tenemos el siguiente fichero <strong>script.sh</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e">#!/bin/bash
</span><span style="color:#75715e"></span>
sed -i <span style="color:#e6db74">&#39;s/$this-&gt;user=&#34;root&#34;;/$this-&gt;user=&#34;&#39;</span><span style="color:#e6db74">${</span>DATABASE_USER<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;&#34;;/g&#39;</span> /var/www/html/core/controller/Database.php
sed -i <span style="color:#e6db74">&#39;s/$this-&gt;pass=&#34;&#34;;/$this-&gt;pass=&#34;&#39;</span><span style="color:#e6db74">${</span>DATABASE_PASSWORD<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;&#34;;/g&#39;</span> /var/www/html/core/controller/Database.php
sed -i <span style="color:#e6db74">&#39;s/$this-&gt;host=&#34;localhost&#34;;/$this-&gt;host=&#34;&#39;</span><span style="color:#e6db74">${</span>DATABASE_HOST<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;&#34;;/g&#39;</span> /var/www/html/core/controller/Database.php
apache2ctl -D FOREGROUND
</code></pre></div><p>Una vez hecho solo debemos de generar la imagen con el comando <strong>build</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e">#### Generamos la imagen ####</span>
francisco@debian10:~/Documentos/Implantacion/Docker/Docker-php/Tarea 2/Build$ docker build -t franjavimn/bookmedik-php:v1 .

<span style="color:#75715e">#### Comprobamos que se haya creado ####</span>
francisco@debian10:~/Documentos/Implantacion/Docker/Docker-php/Tarea 2/Build$ docker image list
REPOSITORY                    TAG                 IMAGE ID            CREATED             SIZE
franjavimn/bookmedik-php      v1                  c8d4ad15a095        <span style="color:#ae81ff">5</span> hours ago         418MB
</code></pre></div><h2 id="creando-el-fichero-docker-compose">Creando el fichero docker-compose</h2>
<p>Una vez hayamos creado la imagen, vamos a editar neustro fichero de <strong>docker-compose.yml</strong> y le vamos a añadir un nuevo contenedor, en este caso es donde vamos a tener nuestra aplicacion de <strong>bookmedik</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml"><span style="color:#f92672">version</span>: <span style="color:#e6db74">&#34;3.1&#34;</span>

<span style="color:#f92672">services</span>:
  <span style="color:#f92672">db</span>:
    <span style="color:#f92672">container_name</span>: <span style="color:#ae81ff">servidor_mysql-php</span>
    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">mariadb</span>
    <span style="color:#f92672">restart</span>: <span style="color:#ae81ff">always</span>
    <span style="color:#f92672">environment</span>:
      <span style="color:#f92672">MYSQL_DATABASE</span>: <span style="color:#ae81ff">bookmedik</span>
      <span style="color:#f92672">MYSQL_USER</span>: <span style="color:#ae81ff">bookmedik</span>
      <span style="color:#f92672">MYSQL_PASSWORD</span>: <span style="color:#ae81ff">bookmedik</span>
      <span style="color:#f92672">MYSQL_ROOT_PASSWORD</span>: <span style="color:#ae81ff">franciscojavier</span>
    <span style="color:#f92672">volumes</span>:
      - <span style="color:#ae81ff">/opt/mysql_bookmedik-php:/var/lib/mysql</span>

  <span style="color:#f92672">bookmedik</span>:
    <span style="color:#f92672">container_name</span>: <span style="color:#ae81ff">bookmedik-php</span>
    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">franjavimn/bookmedik-php:v1</span>
    <span style="color:#f92672">restart</span>: <span style="color:#ae81ff">always</span>
    <span style="color:#f92672">ports</span>:
      - <span style="color:#ae81ff">8083</span>:<span style="color:#ae81ff">80</span>
    <span style="color:#f92672">volumes</span>:
      - <span style="color:#ae81ff">/opt/bookmedik-php:/var/log/apache2</span>
</code></pre></div><p>Una vez hecho esto, debemos de pasar el script de la creacion de las tablas a nuestro contenedor de mariadb, este fichero esta en el directorio que hemos generado tras clonar el repositorio y su nombre es <strong>schema.sql</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e">#### Levantamos el escenario ####</span>
francisco@debian10:~/Documentos/Implantacion/Docker/Docker-php/Tarea 2/Deploy$ docker-compose up -d
Creating servidor_mysql-php ... <span style="color:#66d9ef">done</span>
Creating bookmedik-php      ... <span style="color:#66d9ef">done</span>

<span style="color:#75715e">#### Le pasamos el script ####</span>
francisco@debian10:~/Documentos/Implantacion/Docker/Docker-php/Tarea 2$ cat ../Build/bookmedik/schema.sql | docker exec -i servidor_mysql-php /usr/bin/mysql -u root --password<span style="color:#f92672">=</span>franciscojavier bookmedik
</code></pre></div><p>Y ahora, si entramos en <strong>localhost:8083</strong> veremos que nos sale nuestro login el cual es <strong>admin/admin</strong> y debe de salirnos algo como lo siguiente:</p>
<p><img src="https://raw.githubusercontent.com/FranJaviMN/elementos-grado/main/Implantacion/docker/bookmedik-php.png" alt="imagen de php con bookmedik"></p>

  
  </div>
</article>


    <footer id="footer">
  <div class="footer-left">
    Copyright  &copy; 2021  Francisco Javier Martín Núñez 
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
        <li><a href="/sistemas">Sistemas</a></li>
         
        <li><a href="/seguridad">Seguridad</a></li>
         
        <li><a href="/servicios">Servicios</a></li>
         
        <li><a href="/implantacion">Implantacion</a></li>
         
        <li><a href="/bbdd">BBDD</a></li>
         
        <li><a href="/hlc">HLC</a></li>
         
        <li><a href="/proyecto-podman">Proyecto Podman</a></li>
        
      </ul>
    </nav>
  </div>
</footer>


  </div>
  
</body>

<link rel="stylesheet" href=/lib/font-awesome/css/all.min.css>
<script src=/lib/jquery/jquery.min.js></script>
<script src=/js/main.js></script>
</html>
