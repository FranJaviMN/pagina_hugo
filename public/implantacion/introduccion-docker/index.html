<!DOCTYPE html>
<html lang="es-ES">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title> Introduccion Docker | Blog</title>
  <meta name="description" content="En esta página estatica vamos a guardar algunos de los trabajos que vaya realizando a lo largo del curso de 2ºASIR en el instituto I.E.S. Gonzalo Nazareno.">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="robots" content="all,follow">
  <meta name="googlebot" content="index,follow,snippet,archive">
  <meta property="og:title" content="Introduccion Docker" />
<meta property="og:description" content="Intrducción a Docker Docker es una tecnología de virtualización “ligera” cuyo elemento básico es la utilización de contenedores en vez de máquinas virtuales y cuyo objetivo principal es el despliegue de aplicaciones encapsuladas en dichos contenedores.
Docker está formado por varios componentes:
  Docker Engine: Es un demonio que corre sobre cualquier distribución de Linux y que expone una API externa para la gestión de imágenes y contenedores. Con ella podemos crear imágnenes, subirlas y bajarla de un registro de docker y ejecutar y gestionar contenedores." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://franjavimn.onrender.com/implantacion/introduccion-docker/" />
<meta property="article:published_time" content="2021-02-01T13:22:55+01:00" />
<meta property="article:modified_time" content="2021-02-01T13:22:55+01:00" />

  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Introduccion Docker"/>
<meta name="twitter:description" content="Intrducción a Docker Docker es una tecnología de virtualización “ligera” cuyo elemento básico es la utilización de contenedores en vez de máquinas virtuales y cuyo objetivo principal es el despliegue de aplicaciones encapsuladas en dichos contenedores.
Docker está formado por varios componentes:
  Docker Engine: Es un demonio que corre sobre cualquier distribución de Linux y que expone una API externa para la gestión de imágenes y contenedores. Con ella podemos crear imágnenes, subirlas y bajarla de un registro de docker y ejecutar y gestionar contenedores."/>

  
  
    
  
  
  <link rel="stylesheet" href="https://franjavimn.onrender.com/css/style-white.css">
  
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  

  
<link rel="icon" type="image/png" href="https://franjavimn.onrender.com/images/favicon.ico" />

  
</head>
<body class="max-width mx-auto px3 ltr">
  <div class="content index py4">

    <header id="header">
  <a href="https://franjavimn.onrender.com">
  
    <div id="logo" style="background-image: url(https://franjavimn.onrender.com/images/logo.png)"></div>
  
  <div id="title">
    <h1>Blog</h1>
  </div>
  </a>
  <div id="nav">
    <ul>
      <li class="icon">
        <a href="#"><i class="fas fa-bars fa-2x"></i></a>
      </li>
       
        <li><a href="/sistemas">Sistemas</a></li>
       
        <li><a href="/seguridad">Seguridad</a></li>
       
        <li><a href="/servicios">Servicios</a></li>
       
        <li><a href="/implantacion">Implantacion</a></li>
       
        <li><a href="/bbdd">BBDD</a></li>
       
        <li><a href="/hlc">HLC</a></li>
       
        <li><a href="/cloud">Cloud</a></li>
      
    </ul>
  </div>
</header>
  

    
<article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <div class="content" itemprop="articleBody">
  
    <h1 id="intrducción-a-docker">Intrducción a Docker</h1>
<p>Docker es una tecnología de virtualización “ligera” cuyo elemento básico es la utilización de contenedores en vez de máquinas virtuales y cuyo objetivo principal es el despliegue de aplicaciones encapsuladas en dichos contenedores.</p>
<p>Docker está formado por varios componentes:</p>
<ul>
<li>
<p>Docker Engine: Es un demonio que corre sobre cualquier distribución de Linux y que expone una API externa para la gestión de imágenes y contenedores. Con ella podemos crear imágnenes, subirlas y bajarla de un registro de docker y ejecutar y gestionar contenedores.</p>
</li>
<li>
<p>Docker Client: Es el cliente de línea de comandos (CLI) que nos permite gestionar el Docker Engine. El cliente docker se puede configurar para trabajar con con un Docker Engine local o remoto, permitiendo gestionar tanto nuestro entorno de desarrollo local, como nuestro entorno de producción.</p>
</li>
<li>
<p>Docker Registry: La finalidad de este componente es almacenar las imágenes generadas por el Docker Engine. Puede estar instalada en un servidor independiente y es un componente fundamental, ya que nos permite distribuir nuestras aplicaciones. Es un proyecto open source que puede ser instalado gratuitamente en cualquier servidor, pero, como hemos comentado, el proyecto nos ofrece DockerHub.</p>
</li>
</ul>
<h1 id="instalando-docker">Instalando docker</h1>
<p>En Debian 10 el paquete que debemos de instalar se llama <strong>docker.io</strong> que es la version de la comunidad y esta en repositorios de Debian:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e">#### Instalar docker.io ####</span>
francisco@debian10:~$ sudo apt install docker.io
</code></pre></div><p>Si con un usuario que no sea root queremos usar docker, debemos de añadir a ese usuario al grupo de <strong>docker</strong>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">root@debian10:~# usermod -aG docker usuario
</code></pre></div><h1 id="primer-contenedor-hola-mundo">Primer contenedor: Hola mundo</h1>
<p>Para la primera prueba con docker vamos a usar una imagen que tenemos en los repositorio de DockerHub que se llama <strong>hello-world</strong> con la que vamos a comprobar si funciona docker correctamente, para ello usaremos el comando <strong>run</strong> que nos permite ejecutar un contenedor seguido del nombre de la imagen que vamos a usar, en este caso vamos a usar la imagen <strong>hello-world</strong>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e">#### Ejecutamos el contenedor con la imagen hello-world ####</span>
francisco@debian10:~$ docker run hello-world
Unable to find image <span style="color:#e6db74">&#39;hello-world:latest&#39;</span> locally
latest: Pulling from library/hello-world
0e03bdcc26d7: Pull complete 
Digest: sha256:31b9c7d48790f0d8c50ab433d9c3b7e17666d6993084c002c2ff1ca09b96391d
Status: Downloaded newer image <span style="color:#66d9ef">for</span> hello-world:latest

Hello from Docker!
This message shows that your installation appears to be working correctly.

To generate this message, Docker took the following steps:
 1. The Docker client contacted the Docker daemon.
 2. The Docker daemon pulled the <span style="color:#e6db74">&#34;hello-world&#34;</span> image from the DockerHub.
    <span style="color:#f92672">(</span>amd64<span style="color:#f92672">)</span>
 3. The Docker daemon created a new container from that image which runs the
    executable that produces the output you are currently reading.
 4. The Docker daemon streamed that output to the Docker client, which sent it
    to your terminal.
...
</code></pre></div><p>Como vemos, al no tener la imagen que le estamos diciendo a docker, este busca la imagen en los repositorios de DockerHub y la descarga y muestra el mensaje de bienvenida que es la consecuencia de crear y arrancar un contenedor basado en esa imagen.</p>
<p>Ahora podemos listar los contenedores que tenemos activos con el comando <strong>ps</strong> y si le añadimos la opcion <strong>-a</strong> nos muestra los contenedores que tenemos inactivos:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e">#### Listamos los contenedores que se estan ejecutando ####</span>
francisco@debian10:~$ sudo docker ps
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES

<span style="color:#75715e">#### Listamos los contenedores que no se estan ejecutando ####</span>
francisco@debian10:~$ sudo docker ps -a
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                      PORTS               NAMES
9ba7ea0d8fc2        hello-world         <span style="color:#e6db74">&#34;/hello&#34;</span>            <span style="color:#ae81ff">13</span> minutes ago      Exited <span style="color:#f92672">(</span>0<span style="color:#f92672">)</span> <span style="color:#ae81ff">13</span> minutes ago                       objective_carson
</code></pre></div><p>Comprobamos que este contenedor no se está ejecutando. <strong>Un contenedor ejecuta un proceso y cuando termina la ejecución, el contenedor se para</strong>.</p>
<p>Si queremos eliminar un contenedor que tenemos creado, <strong>es importante saber que debe de estar inactivo antes de poder eliminarlo</strong>, de lo contrario no nos dejara eliminar dicho contenedor:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e">#### Paramos el contenedor si estuviera en ejecución ####</span>
francisco@debian10:~$ docker stop nombre-contenedor

<span style="color:#75715e">#### Lo borramos ####</span>
francisco@debian10:~$ docker rm objective_carson
objective_carson
</code></pre></div><p>Como vemos si no le indicamos un nombre al contenedor, docker le da uno aleatorio.</p>
<h1 id="contenedor-interactivo">Contenedor interactivo</h1>
<p>En este caso usamos la opción <strong>-i</strong> para abrir una sesión interactiva, <strong>-t</strong> nos permite crear un pseudo-terminal que nos va a permitir interaccionar con el contenedor, indicamos un nombre del contenedor con la opción <strong>&ndash;name</strong>, y la imagen que vamos a utilizar para crearlo, en este caso se va a llamar prueba-debian y va a ejecutar comoi comando <strong>/bin/bash</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e">#### Iniciamos el contenedor interactivo ####</span>
francisco@debian10:~$ docker run -it --name prueba-debian debian /bin/bash
Unable to find image <span style="color:#e6db74">&#39;debian:latest&#39;</span> locally
latest: Pulling from library/debian
b9a857cbf04d: Pull complete 
Digest: sha256:b16f66714660c4b3ea14d273ad8c35079b81b35d65d1e206072d226c7ff78299
Status: Downloaded newer image <span style="color:#66d9ef">for</span> debian:latest
root@f7b0f807a1a2:/# 

<span style="color:#75715e">#### Salimos del contenedor y vemos que se ha parado ####</span>
root@f7b0f807a1a2:/# exit
francisco@debian10:~$ docker ps -a
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                     PORTS               NAMES
f7b0f807a1a2        debian              <span style="color:#e6db74">&#34;/bin/bash&#34;</span>         <span style="color:#ae81ff">45</span> seconds ago      Exited <span style="color:#f92672">(</span>0<span style="color:#f92672">)</span> <span style="color:#ae81ff">3</span> seconds ago                       prueba-debian

<span style="color:#75715e">#### Lo volvemos a iniciar ####</span>
francisco@debian10:~$ docker start prueba-debian

<span style="color:#75715e">#### Le podemos pasar comando con la opcion exec ####</span>
francisco@debian10:~$ docker exec prueba-debian ls -la
total <span style="color:#ae81ff">72</span>
drwxr-xr-x   <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">4096</span> Feb  <span style="color:#ae81ff">1</span> 12:18 .
drwxr-xr-x   <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">4096</span> Feb  <span style="color:#ae81ff">1</span> 12:18 ..
-rwxr-xr-x   <span style="color:#ae81ff">1</span> root root    <span style="color:#ae81ff">0</span> Feb  <span style="color:#ae81ff">1</span> 12:18 .dockerenv
drwxr-xr-x   <span style="color:#ae81ff">2</span> root root <span style="color:#ae81ff">4096</span> Jan <span style="color:#ae81ff">11</span> 00:00 bin
drwxr-xr-x   <span style="color:#ae81ff">2</span> root root <span style="color:#ae81ff">4096</span> Nov <span style="color:#ae81ff">22</span> 12:37 boot
drwxr-xr-x   <span style="color:#ae81ff">5</span> root root  <span style="color:#ae81ff">360</span> Feb  <span style="color:#ae81ff">1</span> 12:20 dev
drwxr-xr-x   <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">4096</span> Feb  <span style="color:#ae81ff">1</span> 12:18 etc
drwxr-xr-x   <span style="color:#ae81ff">2</span> root root <span style="color:#ae81ff">4096</span> Nov <span style="color:#ae81ff">22</span> 12:37 home
drwxr-xr-x   <span style="color:#ae81ff">7</span> root root <span style="color:#ae81ff">4096</span> Jan <span style="color:#ae81ff">11</span> 00:00 lib
drwxr-xr-x   <span style="color:#ae81ff">2</span> root root <span style="color:#ae81ff">4096</span> Jan <span style="color:#ae81ff">11</span> 00:00 lib64
drwxr-xr-x   <span style="color:#ae81ff">2</span> root root <span style="color:#ae81ff">4096</span> Jan <span style="color:#ae81ff">11</span> 00:00 media
drwxr-xr-x   <span style="color:#ae81ff">2</span> root root <span style="color:#ae81ff">4096</span> Jan <span style="color:#ae81ff">11</span> 00:00 mnt
drwxr-xr-x   <span style="color:#ae81ff">2</span> root root <span style="color:#ae81ff">4096</span> Jan <span style="color:#ae81ff">11</span> 00:00 opt
dr-xr-xr-x <span style="color:#ae81ff">221</span> root root    <span style="color:#ae81ff">0</span> Feb  <span style="color:#ae81ff">1</span> 12:20 proc
drwx------   <span style="color:#ae81ff">2</span> root root <span style="color:#ae81ff">4096</span> Jan <span style="color:#ae81ff">11</span> 00:00 root
...

<span style="color:#75715e">#### Vemos la informacion del contenedor ####</span>
francisco@debian10:~$ docker inspect prueba-debian
<span style="color:#f92672">[</span>
    <span style="color:#f92672">{</span>
        <span style="color:#e6db74">&#34;Id&#34;</span>: <span style="color:#e6db74">&#34;f7b0f807a1a2e02dbc614e971b32f26cd93f396a2d87987019a658a6ab16a602&#34;</span>,
        <span style="color:#e6db74">&#34;Created&#34;</span>: <span style="color:#e6db74">&#34;2021-02-01T12:18:33.172823479Z&#34;</span>,
        <span style="color:#e6db74">&#34;Path&#34;</span>: <span style="color:#e6db74">&#34;/bin/bash&#34;</span>,
        <span style="color:#e6db74">&#34;Args&#34;</span>: <span style="color:#f92672">[]</span>,
        <span style="color:#e6db74">&#34;State&#34;</span>: <span style="color:#f92672">{</span>
            <span style="color:#e6db74">&#34;Status&#34;</span>: <span style="color:#e6db74">&#34;running&#34;</span>,
...
</code></pre></div><h1 id="ejercicios">Ejercicios</h1>
<ol>
<li>Instala docker en una máquina y configuralo para que se pueda usar con un usuario sin privilegios.</li>
</ol>
<p>Para ello seguimos los pasos de esta introduccion e instalamos docker en nuestra maquina personal desde los repositorios, en mi caso usando una maquina Debian 10:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e">#### Instalamos el paquete llamado docker.io #####</span>
root@debian10:~# apt update <span style="color:#f92672">&amp;&amp;</span> apt upgrade

root@debian10:~# apt install docker.io

<span style="color:#75715e">#### Añadimos nuestro usuario al grupo de docker ####</span>
root@debian10:~# usermod -aG docker francisco

<span style="color:#75715e">#### Comprobamos que esta en el grupo docker ####</span>
francisco@debian10:~$ groups 
.   .   .  docker

<span style="color:#75715e">#### Vemos la version de docker ####</span>
francisco@debian10:~$ docker --version
Docker version 18.09.1, build 4c52b90
</code></pre></div><p>Debemos de tener en cuenta que a la hora de añadir a nuestro usuario al grupo docker, debemos de reiniciar la sesion para que el cambio pueda verse.</p>
<ol start="2">
<li>Crea un contenedor interactivo desde una imagen debian. Instala un paquete (por ejemplo nano). Sal de la terminal, ¿sigue el contenedor corriendo? ¿Por qué?. Vuelve a iniciar el contenedor y accede de nuevo a él de forma interactiva. ¿Sigue instalado el nano?. Sal del contenedor, y borralo. Crea un nuevo contenedor interactivo desde la misma imagen. ¿Tiene el nano instalado?</li>
</ol>
<p>Para ello vamos a usar la imagen que tenemos en <strong>DockerHub</strong> de debian, por lo que primero vamos a descargar la imagen, para ello usaremos el comando <strong>docker run nombre-imagen</strong> y este comando lo que hara es descargar la imagen y ejecutar el contenedor al mismo tiempo. Como tambien queremos que nuestro contenedor sea interactivo, a este comando debemos de añadirle las opciones <strong>&ndash;it</strong> donde le indicamos que va a ser una consola interactiva:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e">#### Ejecutamos el contenedor interactivo de debian ####</span>
francisco@debian10:~$ docker run -it --name prueba-debian debian /bin/bash
Unable to find image <span style="color:#e6db74">&#39;debian:latest&#39;</span> locally
latest: Pulling from library/debian
b9a857cbf04d: Pull complete 
Digest: sha256:b16f66714660c4b3ea14d273ad8c35079b81b35d65d1e206072d226c7ff78299
Status: Downloaded newer image <span style="color:#66d9ef">for</span> debian:latest
root@c26222c4e600:/# 
</code></pre></div><p>Como vemos ya estamos dentro del contenedor con debian, ahora, siguiendo con el ejercicio, vamos a instalar el paquete nano en nuestro contenedor, cabe destacar que el contenedor es muy basico y solo trae lo necesario para poder funcionar, por lo que la gran mayoria de paquetes no estaran disponibles.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e">#### Instalamos nano ####</span>
root@c26222c4e600:/# apt update <span style="color:#f92672">&amp;&amp;</span> apt install nano
</code></pre></div><p>Ahora vamos a salir de la terminal para ver si el contenedor sigue corriendo despues de salir y como podemos ver el contenedor ya esta parado:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">francisco@debian10:~$ docker ps 
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES
</code></pre></div><p>Esto se debe a que el contenedor solo debia de ejecutar la bash interactiva para que nosotros entremos y hagamos lo que necesitemos, pero a la hora de salir ya deja de ser interactivo y el proceso de bash que estaba ejecutando ya no lo ejecuta, por lo que el contenedor se para:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">francisco@debian10:~$ docker ps -a
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                     PORTS               NAMES
c26222c4e600        debian              <span style="color:#e6db74">&#34;/bin/bash&#34;</span>         <span style="color:#ae81ff">5</span> minutes ago       Exited <span style="color:#f92672">(</span>0<span style="color:#f92672">)</span> <span style="color:#ae81ff">2</span> minutes ago                       prueba-debian
</code></pre></div><p>Bien, ahora vamos a iniciar el contenedor y vamos a entrar de forma interactiva a este para poder ver si sigue instalado el programa nano, por lo que vaos a ejecutar el siguiente comando:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e">#### Iniciamos el contenedor ####</span>
francisco@debian10:~$ docker start prueba-debian
prueba-debian

francisco@debian10:~$ docker ps 
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES
c26222c4e600        debian              <span style="color:#e6db74">&#34;/bin/bash&#34;</span>         <span style="color:#ae81ff">7</span> minutes ago       Up <span style="color:#ae81ff">3</span> seconds                            prueba-debian

<span style="color:#75715e">#### Entramos de forma interactiva al contenedor ####</span>
francisco@debian10:~$ docker attach prueba-debian
root@c26222c4e600:/#

<span style="color:#75715e">#### Comprobamos que el programa nano esta instalado ####</span>
root@c26222c4e600:/# whereis nano
nano: /bin/nano /usr/share/nano /usr/share/man/man1/nano.1.gz /usr/share/info/nano.info.gz
</code></pre></div><p>Como vemos el comando nano si esta instalado aunque hayamos parado el contenedor pero ahora vamos a comprobar que ocurre cuando lo borramos y volvemos a crear:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e">#### Salimos del contenedor y lo borramos ####</span>
francisco@debian10:~$ docker rm prueba-debian
prueba-debian
francisco@debian10:~$ docker ps -a
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES

<span style="color:#75715e">#### Creamos de nuevo el contenedor con la misma imagen ####</span>
francisco@debian10:~$ docker run -it --name prueba-debian2 debian
root@a278a0e80ee6:/# 

<span style="color:#75715e">#### Comprobamos que el contenedor no contiene el programa nano ####</span>
root@a278a0e80ee6:/# whereis nano
nano:
</code></pre></div><p>Esto se debe a que los datos que estan en un contenedor solo estan en ese contenedor por lo que al borrar ese contenedor todo lo que haya en su interior se borra y este contenido no se guarda, por eso al volver a usar la imagen de debian que habiamos descargado esta no contiene nada.</p>
<ol start="3">
<li>Crea un contenedor demonio con un servidor nginx, usando la imagen oficial de nginx. Al crear el contenedor, ¿has tenido que indicar algún comando para que lo ejecute? Accede al navegador web y comprueba que el servidor esta funcionando. Muestra los logs del contenedor.</li>
</ol>
<p>Bien, ahora vamos a usar la imagen de <strong>nginx</strong> para poder tener un servidor web con nginx, para ello vamos a usar la imagen de docker llamada <strong>nginx</strong>. En este comando para iniciar el servidor web de nginx debemos de indicarle la opción <strong>-p</strong> con la que mapeamos un puerto del equipo donde tenemos instalado el docker, con un puerto del contenedor. Para ello vamos a usar el puerto 8080 de nuestra maquina, y nginx usara el puerto 80 para conectar con nuestro equipo y tambien usaremos el comando <strong>-d</strong> para que se ejecute en segundo plano:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e">#### Ejecutamos el contenedor con las opciones necesarias ####</span>
francisco@debian10:~$ sudo docker run -d --name prueba-nginx -p 8080:80 nginx

<span style="color:#75715e">#### Comprobamos el contenedor ####</span>
francisco@debian10:~$ sudo docker ps 
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                  NAMES
c0bf146c82b6        nginx               <span style="color:#e6db74">&#34;/docker-entrypoint.…&#34;</span>   <span style="color:#ae81ff">28</span> seconds ago      Up <span style="color:#ae81ff">24</span> seconds       0.0.0.0:8080-&gt;80/tcp   prueba-nginx

<span style="color:#75715e">#### Comprobamos los logs de ese contenedor ####</span>
francisco@debian10:~$ sudo docker logs prueba-nginx
/docker-entrypoint.sh: /docker-entrypoint.d/ is not empty, will attempt to perform configuration
/docker-entrypoint.sh: Looking <span style="color:#66d9ef">for</span> shell scripts in /docker-entrypoint.d/
/docker-entrypoint.sh: Launching /docker-entrypoint.d/10-listen-on-ipv6-by-default.sh
10-listen-on-ipv6-by-default.sh: info: Getting the checksum of /etc/nginx/conf.d/default.conf
10-listen-on-ipv6-by-default.sh: info: Enabled listen on IPv6 in /etc/nginx/conf.d/default.conf
/docker-entrypoint.sh: Launching /docker-entrypoint.d/20-envsubst-on-templates.sh
/docker-entrypoint.sh: Configuration complete; ready <span style="color:#66d9ef">for</span> start up
172.17.0.1 - - <span style="color:#f92672">[</span>01/Feb/2021:08:48:03 +0000<span style="color:#f92672">]</span> <span style="color:#e6db74">&#34;GET / HTTP/1.1&#34;</span> <span style="color:#ae81ff">200</span> <span style="color:#ae81ff">612</span> <span style="color:#e6db74">&#34;-&#34;</span> <span style="color:#e6db74">&#34;Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0&#34;</span> <span style="color:#e6db74">&#34;-&#34;</span>
2021/02/01 08:48:03 <span style="color:#f92672">[</span>error<span style="color:#f92672">]</span> 28#28: *1 open<span style="color:#f92672">()</span> <span style="color:#e6db74">&#34;/usr/share/nginx/html/favicon.ico&#34;</span> failed <span style="color:#f92672">(</span>2: No such file or directory<span style="color:#f92672">)</span>, client: 172.17.0.1, server: localhost, request: <span style="color:#e6db74">&#34;GET /favicon.ico HTTP/1.1&#34;</span>, host: <span style="color:#e6db74">&#34;localhost:8080&#34;</span>
172.17.0.1 - - <span style="color:#f92672">[</span>01/Feb/2021:08:48:03 +0000<span style="color:#f92672">]</span> <span style="color:#e6db74">&#34;GET /favicon.ico HTTP/1.1&#34;</span> <span style="color:#ae81ff">404</span> <span style="color:#ae81ff">153</span> <span style="color:#e6db74">&#34;-&#34;</span> <span style="color:#e6db74">&#34;Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0&#34;</span> <span style="color:#e6db74">&#34;-&#34;</span>
</code></pre></div><p>Asi, al entrar en http://localhost:8080 nos debe de aparecer el siguiente contenido:</p>
<p><img src="https://raw.githubusercontent.com/FranJaviMN/elementos-grado/main/Implantacion/docker/nginx-docker.png" alt="docker nginx"></p>
<ol start="4">
<li>Crea un contenedor con la aplicación Nextcloud, mirando la documentación en DockerHub, para personalizar el nombre de la base de datos sqlite que va autilizar.</li>
</ol>
<p>Para ello nos debemos de ir a la pagina de DockerHub y ahi vamos a buscar la imagen de <strong>nextcloud</strong>, para ell vamos a seguir el mismo proceso que hemos seguido en el anterior ejercicio y vamos a crear un contenedor con nextcloud:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e">#### Creamos el contenedor con nextcloud en el puerto 8081 ####</span>
francisco@debian10:~$ docker run -d --name prueba-nextcloud -p 8081:80 nextcloud

<span style="color:#75715e">#### Comprobamos el contenedor corriendo ####</span>
francisco@debian10:~$ docker ps 
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                  NAMES
b2dc78dc82ab        nextcloud           <span style="color:#e6db74">&#34;/entrypoint.sh apac…&#34;</span>   <span style="color:#ae81ff">41</span> seconds ago      Up <span style="color:#ae81ff">34</span> seconds       0.0.0.0:8081-&gt;80/tcp   prueba-nextcloud

<span style="color:#75715e">#### Vemos los logs ####</span>
francisco@debian10:~$ docker logs prueba-nextcloud
Initializing nextcloud 20.0.6.1 ...
Initializing finished
New nextcloud instance
AH00558: apache2: Could not reliably determine the server<span style="color:#e6db74">&#39;s fully qualified domain name, using 172.17.0.2. Set the &#39;</span>ServerName<span style="color:#e6db74">&#39; directive globally to suppress this message
</span><span style="color:#e6db74">AH00558: apache2: Could not reliably determine the server&#39;</span>s fully qualified domain name, using 172.17.0.2. Set the <span style="color:#e6db74">&#39;ServerName&#39;</span> directive globally to suppress this message
<span style="color:#f92672">[</span>Mon Feb <span style="color:#ae81ff">01</span> 09:02:22.356402 2021<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>mpm_prefork:notice<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>pid 1<span style="color:#f92672">]</span> AH00163: Apache/2.4.38 <span style="color:#f92672">(</span>Debian<span style="color:#f92672">)</span> PHP/7.4.14 configured -- resuming normal operations
<span style="color:#f92672">[</span>Mon Feb <span style="color:#ae81ff">01</span> 09:02:22.356848 2021<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>core:notice<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>pid 1<span style="color:#f92672">]</span> AH00094: Command line: <span style="color:#e6db74">&#39;apache2 -D FOREGROUND&#39;</span>
</code></pre></div><p>Asi, si entramos en http://localhost:8081 podemos ver que tenemos una aplicacion de nextcloud corriendo:</p>
<p><img src="https://raw.githubusercontent.com/FranJaviMN/elementos-grado/main/Implantacion/docker/nextcloud-docker.png" alt="docker nextcloud"></p>
<h1 id="almacenamiento">Almacenamiento</h1>
<p><strong>Los contenedores son efímeros</strong>, es decir, los ficheros, datos y configuraciones que creamos en los contenedores sobreviven a las paradas de los mismos pero, sin embargo, son destruidos si el contenedor es destruido.</p>
<p>Por lo que todo contenido que tengamos dentro del contenedor puede ser destruido y todo lo que haya en su interior, podemos verlo facilmente con el siguiente ejemplo de un servidor web:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e">#### Creamos el contenedor con la imagen de apache2 ####</span>
debian@omega:~$ docker run -d --name my-apache-app -p 8080:80 httpd:2.4

<span style="color:#75715e">#### Le introducimos un comando para crear un fichero en el documentroot ####</span>
debian@omega:~$ docker exec my-apache-app bash -c <span style="color:#e6db74">&#39;echo &#34;&lt;h1&gt;Hola Docker!!!&lt;/h1&gt;&#34; &gt; htdocs/index.html&#39;</span>

<span style="color:#75715e">#### Comprobamos si tenemos ese mensaje ####</span>
debian@omega:~$ curl http://localhost:8080
&lt;h1&gt;Hola Docker!!!&lt;/h1&gt;

<span style="color:#75715e">#### Borramos el contenedor y lo volvemos a crear ####</span>
debian@omega:~$ docker rm -f my-apache-app
my-apache-app

debian@omega:~$ sudo docker run -d --name my-apache-app -p 8080:80 httpd:2.4

<span style="color:#75715e">#### Comprobamos el mensaje ####</span>
debian@omega:~$ curl http://localhost:8080
&lt;html&gt;&lt;body&gt;&lt;h1&gt;It works!&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;
</code></pre></div><p>Como vemos en el ejemplo anterior podemos ver como los contenedores son efimeros. Pero esto lo podemos solucionar usando volumenes, en este caso podemos hacer mediante dos formas como pueden ser <strong>volumenes docker</strong> o <strong>bind mount</strong></p>
<ul>
<li>
<p>Volúmenes Docker: Si elegimos conseguir la persistencia usando volúmenes estamos haciendo que los datos de los contenedores que nosotros decidamos se almacenen en una parte del sistema de ficheros que es gestionada por docker y a la que, debido a sus permisos, sólo docker tendrá acceso. En linux se guardan en /var/lib/docker/volumes. Este tipo de volúmenes se suele usar en los siguiente casos:</p>
<ul>
<li>Para compartir datos entre contenedores. Simplemente tendrán que usar el mismo volumen.</li>
<li>Para copias de seguridad ya sea para que sean usadas posteriormente por otros contenedores o para mover esos volúmenes a otros hosts.</li>
<li>Cuando quiero almacenar los datos de mi contenedor no localmente si no en un proveedor cloud.</li>
</ul>
</li>
<li>
<p>Bind mounts: Si elegimos conseguir la persistencia de los datos de los contenedores usando bind mount lo que estamos haciendo es “mapear” (montar) una parte de mi sistema de ficheros, de la que yo normalmente tengo el control, con una parte del sistema de ficheros del contenedor. De esta manera conseguimos:</p>
<ul>
<li>Compartir ficheros entre el host y los containers.</li>
<li>Que otras aplicaciones que no sean docker tengan acceso a esos ficheros, ya sean código, ficheros etc…</li>
</ul>
</li>
</ul>
<h2 id="gestión-de-volúmenes-docker">Gestión de volúmenes Docker</h2>
<p>Algunos comando útiles para trabajar con volúmenes docker:</p>
<ul>
<li>docker volumen create: Crea un volumen con el nombre indicado.</li>
<li>docker volume rm: Elimina el volumen indicado.</li>
<li>docker volumen prune: Para eliminar los volúmenes que no están siendo usados por ningún contenedor.</li>
<li>docker volume ls: Nos proporciona una lista de los volúmenes creados y algo de información adicional.</li>
<li>docker volume inspect: Nos dará una información mucho más detallada de el volumen que hayamos elegido.</li>
</ul>
<h2 id="qué-información-tenemos-que-guardar">¿Qué información tenemos que guardar?</h2>
<p>Para terminar: ¿Qué debemos guardar de forma persistente en un contenedor?</p>
<ul>
<li>Los datos de la aplicación</li>
<li>Los logs del servicio</li>
<li>La configuración del servicio: En este caso podemos añadirla a la imagen, pero será necesaria la creación de una nueva imagen si cambiamos la configuració</li>
<li>Si la guardamos en un volumen hay que tener en cuanta que ese fichero lo tenemos que tener en el entorno de producción (puede ser bueno, porque l</li>
<li>configuraciones de los distintos entornos puede variar).</li>
</ul>
<h2 id="asociando-almacenamiento-a-los-contenedores">Asociando almacenamiento a los contenedores</h2>
<p>Veamos como puedo usar los volúmenes y los bind mounts en los contenedores. Para cualquiera de los dos casos lo haremos mediante el uso de dos flags de la orden <em>docker run</em>:</p>
<h2 id="ejercicios-1">Ejercicios</h2>
<ol>
<li>Vamos a trabajar con volúmenes docker:
<ul>
<li>Crea un volumen docker que se llame miweb</li>
<li>Crea un contenedor desde la imagen php:7.4-apache donde montes en el directorio/var/www/html(que sabemos que es el docuemntroot del servidor que nos ofrece esa imagen) el volumen docker que has creado.</li>
<li>Utiliza el comando <strong>docker cp</strong> para copiar un fichero info.php en el directorio /var/www/html.</li>
<li>Accede al contenedor desde el navegador para ver la información ofrecida por el fichero info.php.</li>
<li>Borra el contenedor</li>
<li>Crea un nuevo contenedor y monta el mismo volumen como en el ejercicio anterior.</li>
<li>Accede al contenedor desde el navegador para ver la información ofrecida por el fichero info.php. ¿Seguía existiendo ese fichero?</li>
</ul>
</li>
</ol>
<p>Para ello lo primero que debemos de hacer es crear el volumen, para ello debemos de usar comando <strong>docker volume create</strong>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e">#### Creamos el volumen llamado miweb ####</span>
debian@omega:~$ sudo docker volume create miweb
miweb

<span style="color:#75715e">#### Creamos el nuevo contenedor con la imagen php:7.4-apache ####</span>
debian@omega:~$ sudo docker run -d --name prueba-volumenes -v miweb:/var/www/html -p 8080:80 php:7.4-apache

<span style="color:#75715e">#### Le añadimos un fichero info.php con docker cp ####</span>
debian@omega:~$ cat info.php 
&lt;?php phpinfo<span style="color:#f92672">()</span>;?&gt;

debian@omega:~$ sudo docker cp info.php prueba-volumenes:/var/www/html
</code></pre></div><p>De esta forma ya lo tendremos funcionando y si entramos en el direccion de la maquina indicando el puerto y el fichero <em>info.php</em> podremos ver la información que nos ofrece php.</p>
<p>Ahora vamos a destruir el contenedor y lo vamos a volver a crear para comprobar como sigue sirviendo el fichero info.php porque este fichero esta en un volumen, el cual no se borra al destruir un contenedor:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e">#### Destruimos el contenedor ####</span>
debian@omega:~$ sudo docker rm -f prueba-volumenes
prueba-volumenes

<span style="color:#75715e">#### Volvemos a crear el volumen ####</span>
debian@omega:~$ sudo docker run -d --name prueba-volumenes -v miweb:/var/www/html -p 8080:80 php:7.4-apache
</code></pre></div><p>Si volvemos a entrar en la dirección del contenedor veremos que nos sigue mostrando el fichero de <em>info.php</em></p>
<ol start="2">
<li>Vamos a trabajar con bind mount:
<ul>
<li>Crea un directorio en tu host y dentro crea un fichero index.html.</li>
<li>Crea un contenedor desde la imagen php:7.4-apache donde montes en el directorio /var/www/html el directorio que has creado por medio de bind mount.</li>
<li>Accede al contenedor desde el navegador para ver la información ofrecida por el fichero index.html.</li>
<li>Modifica el contenido del fichero index.html en tu host y comprueba que al refrescar la página ofrecida por el contenedor, el contenido ha cambiado.</li>
<li>Borra el contenedor</li>
<li>Crea un nuevo contenedor y monta el mismo directorio como en el ejercicio anterior.</li>
<li>Accede al contenedor desde el navegador para ver la información ofrecida por el fichero index.html. ¿Se sigue viendo el mismo contenido?</li>
</ul>
</li>
</ol>
<p>Lo primero es crear el directorio que lo vamos a llamar <em>vol-html</em> y le vamos a añadir un nuevo fichero <em>index.php</em> con un mensaje de saludo. Una vez hecho debemos de crear un nuevo contenedor en el que vamos a montar el directorio mediando <strong>bind mount</strong> para que nos sirva el contenido de ese directorio, para ell seguimos los siguientes pasos:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e">#### Creamos el directorio y el fichero ####</span>
debian@omega:~$ mkdir vol-html
debian@omega:~$ cd vol-html/
debian@omega:~/vol-html$ nano index.html

<span style="color:#75715e">#### Creamos el contenedor montando el dirctorio vol-html ####</span>
debian@omega:~$ sudo docker run -d --name prueba-volumenes -v /home/debian/vol-html/:/var/www/html -p 8080:80 php:7.4-apache

<span style="color:#75715e">#### Comprobamos el mensaje de bienvenida ####</span>
debian@omega:~$ curl http://localhost:8080
&lt;h1&gt;Hola Docker!!!&lt;/h1&gt;

<span style="color:#75715e">#### Modificamos el mensaje y vemos si nos lo muestra de nuevo ####</span>
debian@omega:~$ nano vol-html/index.html
debian@omega:~$ curl http://localhost:8080
&lt;h1&gt;Hola Docker!!!, Bienvenido&lt;/h1&gt;
</code></pre></div><p>Ahora lo que vamos a hacer es borrar el contenedor y vamos a volver a crearlo para ver que no hemos perdido el contenido que teniamos:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e">#### Borramos el contenedor ####</span>
debian@omega:~$ sudo docker rm -f prueba-volumenes
prueba-volumenes

<span style="color:#75715e">#### Lo volvemos a crear ####</span>
debian@omega:~$ sudo docker run -d --name prueba-volumenes -v /home/debian/vol-html/:/var/www/html -p 8080:80 php:7.4-apache

<span style="color:#75715e">#### Y lo comprobamos ####</span>
debian@omega:~$ curl http://localhost:8080
&lt;h1&gt;Hola Docker!!!, Bienvenido&lt;/h1&gt;
</code></pre></div><ol start="3">
<li>Contenedores con almacenamiento persistente
<ul>
<li>Crea un contenedor desde la imagen nextcloud (usando sqlite) configurando el almacenamiento como nos muestra la documentación de la imagen en Docker Hub* (pero utilizando bind mount). Sube algún fichero.</li>
<li>Elimina el contenedor.</li>
<li>Crea un contenedor nuevo con la misma configuración de volúmenes. Comprueba que la información que teníamos (ficheros, usuaurio, …), sigue existiendo.</li>
<li>Comprueba el contenido de directorio que se ha creado en el host.</li>
</ul>
</li>
</ol>
<p>Para ello vamos a seguir los siguientes pasos:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e">#### Creamos el contenedor ####</span>
debian@omega:~$ sudo docker run -d --name prueba-volumenes -v /home/debian/vol-nextcloud/:/var/www/html -p 8080:80 nextcloud
</code></pre></div><p>Una vez hecho, nos vamos al navegador y ponemos la ip de nuestra maquina y el puerto, y completamos la instalacion de nextcloud. Una vez hecho eso subimos un fichero a nextclodu para ver si, al borrar el contenedor persisten los datos, por lo que subimos un fichero y lo volvemos a crear y veremos que tenemos el mismo fichero que habiamos subido ademas de que ya no tendremos que completar la instalacion de nextcloud ya que la información ya esta almacenada en la base de datos de tipo <strong>sqlite</strong>.</p>

  
  </div>
</article>


    <footer id="footer">
  <div class="footer-left">
    Copyright  &copy; 2021  Francisco Javier Martín Núñez 
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
        <li><a href="/sistemas">Sistemas</a></li>
         
        <li><a href="/seguridad">Seguridad</a></li>
         
        <li><a href="/servicios">Servicios</a></li>
         
        <li><a href="/implantacion">Implantacion</a></li>
         
        <li><a href="/bbdd">BBDD</a></li>
         
        <li><a href="/hlc">HLC</a></li>
         
        <li><a href="/cloud">Cloud</a></li>
        
      </ul>
    </nav>
  </div>
</footer>


  </div>
  
</body>

<link rel="stylesheet" href=/lib/font-awesome/css/all.min.css>
<script src=/lib/jquery/jquery.min.js></script>
<script src=/js/main.js></script>
</html>
