<!DOCTYPE html>
<html lang="es-ES">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title> Practica Cms | Blog</title>
  <meta name="description" content="En esta página estatica vamos a guardar algunos de los trabajos que vaya realizando a lo largo del curso de 2ºASIR en el instituto I.E.S. Gonzalo Nazareno.">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="robots" content="all,follow">
  <meta name="googlebot" content="index,follow,snippet,archive">
  <meta property="og:title" content="Practica Cms" />
<meta property="og:description" content="Instalación local de un CMS PHP Esta tarea consiste en instalar un CMS de tecnología PHP en un servidor local. Los pasos que tendrás que dar los siguientes:
Tarea 1: Instalación de un servidor LAMP   Crear una instancia de vagrant basado en un box debian o ubuntu
  Instala en esa máquina virtual toda la pila LAMP
  Tarea 2: Instalación de drupal en mi servidor local   Configura el servidor web con virtual hosting para que el CMS sea accesible desde la dirección: www." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://franjavimn.onrender.com/implantacion/practica-cms/" />
<meta property="article:published_time" content="2020-10-30T18:03:23+01:00" />
<meta property="article:modified_time" content="2020-10-30T18:03:23+01:00" />

  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Practica Cms"/>
<meta name="twitter:description" content="Instalación local de un CMS PHP Esta tarea consiste en instalar un CMS de tecnología PHP en un servidor local. Los pasos que tendrás que dar los siguientes:
Tarea 1: Instalación de un servidor LAMP   Crear una instancia de vagrant basado en un box debian o ubuntu
  Instala en esa máquina virtual toda la pila LAMP
  Tarea 2: Instalación de drupal en mi servidor local   Configura el servidor web con virtual hosting para que el CMS sea accesible desde la dirección: www."/>

  
  
    
  
  
  <link rel="stylesheet" href="https://franjavimn.onrender.com/css/style-white.css">
  
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  

  
<link rel="icon" type="image/png" href="https://franjavimn.onrender.com/images/favicon.ico" />

  
</head>
<body class="max-width mx-auto px3 ltr">
  <div class="content index py4">

    <header id="header">
  <a href="https://franjavimn.onrender.com">
  
    <div id="logo" style="background-image: url(https://franjavimn.onrender.com/images/logo.png)"></div>
  
  <div id="title">
    <h1>Blog</h1>
  </div>
  </a>
  <div id="nav">
    <ul>
      <li class="icon">
        <a href="#"><i class="fas fa-bars fa-2x"></i></a>
      </li>
       
        <li><a href="/">Home</a></li>
       
        <li><a href="/sistemas">Sistemas</a></li>
       
        <li><a href="/seguridad">Seguridad</a></li>
       
        <li><a href="/servicios">Servicios</a></li>
       
        <li><a href="/implantacion">Implantacion</a></li>
       
        <li><a href="/bbdd">BBDD</a></li>
      
    </ul>
  </div>
</header>
  

    
<article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <div class="content" itemprop="articleBody">
  
    <h1 id="instalación-local-de-un-cms-php">Instalación local de un CMS PHP</h1>
<p>Esta tarea consiste en instalar un CMS de tecnología PHP en un servidor local. Los pasos que tendrás que dar los siguientes:</p>
<h2 id="tarea-1-instalación-de-un-servidor-lamp">Tarea 1: Instalación de un servidor LAMP</h2>
<ul>
<li>
<p>Crear una instancia de vagrant basado en un box debian o ubuntu</p>
</li>
<li>
<p>Instala en esa máquina virtual toda la pila LAMP</p>
</li>
</ul>
<h2 id="tarea-2-instalación-de-drupal-en-mi-servidor-local">Tarea 2: Instalación de drupal en mi servidor local</h2>
<ul>
<li>
<p>Configura el servidor web con virtual hosting para que el CMS sea accesible desde la dirección: <a href="http://www.nombrealumno-drupal.org">www.nombrealumno-drupal.org</a>.</p>
</li>
<li>
<p>Crea un usuario en la base de datos para trabajar con la base de datos donde se van a guardar los datos del CMS.</p>
</li>
<li>
<p>Descarga la versión que te parezca más oportuna de Drupal y realiza la instalación.</p>
</li>
<li>
<p>Realiza una configuración mínima de la aplicación (Cambia la plantilla, crea algún contenido, …)</p>
</li>
<li>
<p>Instala un módulo para añadir alguna funcionalidad a drupal.</p>
</li>
</ul>
<h2 id="tarea-3-configuración-multinodo">Tarea 3: Configuración multinodo</h2>
<ul>
<li>
<p>Realiza un copia de seguridad de la base de datos</p>
</li>
<li>
<p>Crea otra máquina con vagrant, conectada con una red interna a la anterior y configura un servidor de base de datos.</p>
</li>
<li>
<p>Crea un usuario en la base de datos para trabajar con la nueva base de datos.</p>
</li>
<li>
<p>Restaura la copia de seguridad en el nuevo servidor de base datos.</p>
</li>
<li>
<p>Desinstala el servidor de base de datos en el servidor principal.</p>
</li>
<li>
<p>Realiza los cambios de configuración necesario en drupal para que la página funcione.</p>
</li>
</ul>
<h2 id="tarea-4-instalación-de-otro-cms-php">Tarea 4: Instalación de otro CMS PHP</h2>
<ul>
<li>
<p>Elige otro CMS realizado en PHP y realiza la instalación en tu infraestructura.</p>
</li>
<li>
<p>Configura otro virtualhost y elige otro nombre en el mismo dominio.</p>
</li>
</ul>
<h2 id="tarea-5-necesidad-de-otros-servicios">Tarea 5: Necesidad de otros servicios</h2>
<ul>
<li>
<p>La mayoría de los CMS tienen la posibilidad de mandar correos electrónicos (por ejemplo para notificar una nueva versión, notificar un comentario,…)</p>
</li>
<li>
<p>Instala un servidor de correo electrónico en tu servidor. debes configurar un servidor relay de correo, para ello en el fichero /etc/postfix/main.cf, debes poner la siguiente línea:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">relayhost <span style="color:#f92672">=</span> babuino-smtp.gonzalonazareno.org
</code></pre></div></li>
</ul>
<h3 id="tarea-1">Tarea 1</h3>
<p>En esta tarea vamos a realizar el entorno LAMP para poder realizar la practica, para ello vamos a usar el siguiente fichero de Vagrantfile:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#75715e"># vi: set ft=ruby :</span>


$install_LAMP <span style="color:#f92672">=</span> <span style="color:#e6db74">&lt;&lt;-SCRIPT
</span><span style="color:#e6db74"></span><span style="color:#75715e">#actualizamos la lista de paquetes de la maquina</span>
sudo apt update

<span style="color:#75715e">#instalamos mariadb</span>
sudo apt install <span style="color:#f92672">-</span>y mariadb<span style="color:#f92672">-</span>server mariadb<span style="color:#f92672">-</span>client

<span style="color:#75715e">#instalamos apache2</span>
sudo apt install <span style="color:#f92672">-</span>y apache2

<span style="color:#75715e">#instalamos php y una de sus librerias</span>
sudo apt install <span style="color:#f92672">-</span>y php libapache2<span style="color:#f92672">-</span>mod<span style="color:#f92672">-</span>php
<span style="color:#66d9ef">SCRIPT</span>




<span style="color:#66d9ef">Vagrant</span><span style="color:#f92672">.</span>configure(<span style="color:#e6db74">&#34;2&#34;</span>) <span style="color:#66d9ef">do</span> <span style="color:#f92672">|</span>config<span style="color:#f92672">|</span>
  config<span style="color:#f92672">.</span>vm<span style="color:#f92672">.</span>box <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;debian/buster64&#34;</span>
  config<span style="color:#f92672">.</span>vm<span style="color:#f92672">.</span>hostname <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;maquina&#34;</span>
  config<span style="color:#f92672">.</span>vm<span style="color:#f92672">.</span>network <span style="color:#e6db74">:private_network</span>, <span style="color:#e6db74">ip</span>: <span style="color:#e6db74">&#34;192.168.100.100&#34;</span>

  config<span style="color:#f92672">.</span>vm<span style="color:#f92672">.</span>provision <span style="color:#e6db74">&#34;shell&#34;</span>, <span style="color:#e6db74">inline</span>: $install_LAMP
<span style="color:#66d9ef">end</span>
</code></pre></div><p>Donde vemos que tenemos el script creado que nos instala todo lo necesario para poder empezar con nuestro entorno LAMP.</p>
<p>Una vez dentro de nuestra maquina con el entorno LAMP instalado, vamos a pasar a la configuracion de los elementos LAMP.</p>
<h4 id="mariadb">MariaDB</h4>
<p>Lo primero es la creacion de una nueva base de datos en la que vamos a alojar nuestros cms, para ello vamos a usar la siguiente pila de comandos cmabiando los elementos &ldquo;nombredb&rdquo; por el nombre de la base de datos y &ldquo;nombreuser&rdquo; por el nombre del usuario que vamos a crear:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e">#### Entramos como root en mariadb ####</span>
sudo mysql -u root -p

<span style="color:#75715e">#### Creamos la base de datos ####</span>
CREATE DATABASE nombredb;

<span style="color:#75715e">#### Creamos el usuario ####</span>
CREATE USER <span style="color:#e6db74">&#39;nombreuser&#39;</span>@<span style="color:#e6db74">&#39;localhost&#39;</span> IDENTIFIED BY <span style="color:#e6db74">&#39;contraseñauser&#39;</span>;

<span style="color:#75715e">#### Le damos todos los privilegios al nuevo usuario sobre la nueva base de datos ####</span>
GRANT ALL PRIVILEGES ON nombredb.* to <span style="color:#e6db74">&#39;nombreuser&#39;</span>@<span style="color:#e6db74">&#39;localhost&#39;</span>;

<span style="color:#75715e">#### Salimos de mariadb ####</span>
FLUSH PRIVILEGES;
quit
</code></pre></div><h4 id="apache">Apache</h4>
<p>Aqui vamos a crear nuestro virtualhost en apache, para ello vamos a seguir los siguientes pasos:</p>
<ol>
<li>
<p>Nos dirigimos al directorio /etc/apache2/sites-available/ y ahi vamos a crear nuestro nuesvo virtual host al que vamos a llamar drupal.conf:</p>
</li>
<li>
<p>Entramos en el directorio /etc/apache2/sites-available/</p>
</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">cd /etc/apache2/sites-available/
</code></pre></div><ol start="3">
<li>Creamos el nuevo fichero de configuracion</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">sudo cp 000-default.conf ./drupal.conf
</code></pre></div><ol start="4">
<li>Dentro del fichero drupal.conf tendremos lo siguiente</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">&lt;VirtualHost *:80&gt;
        ServerName www.francisco-drupal.org
        ServerAdmin webmaster@localhost
        DocumentRoot /var/www/drupal
        ErrorLog <span style="color:#e6db74">${</span>APACHE_LOG_DIR<span style="color:#e6db74">}</span>/error.log
        CustomLog <span style="color:#e6db74">${</span>APACHE_LOG_DIR<span style="color:#e6db74">}</span>/access.log combined
&lt;/VirtualHost&gt;
</code></pre></div><ol start="5">
<li>Creamos la carpeta drupal en /var/www/</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">sudo mkdir /var/www/drupal
</code></pre></div><ol start="7">
<li>Dentro de /var/www/drupal vamos a crear un fichero index.html con un mensaje de bienvenida</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">sudo nano /var/www/drupal/index.html
</code></pre></div><ol start="8">
<li>Activamos el nuevo virtualhost</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">  sudo a2ensite drupal.conf
</code></pre></div><ol start="9">
<li>Reiniciamos el servicio de apache</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">sudo systemctl reload apache2.service
</code></pre></div><p>Asi, a la hora de entrar en la direccion <a href="http://www.francisco-drupal.org">www.francisco-drupal.org</a>, primero modificamos el fichero /etc/hosts y añadimos la ip de nuestro servidor apache y la direccion de nuestro virtualhost y al entrar en la pagina nos saldra lo siguiente:</p>
<p><img src="https://raw.githubusercontent.com/FranJaviMN/elementos-grado/main/Implantacion/CMS-LAMP/drupal-prueba.png" alt="Prueba de drupal"></p>
<h4 id="php">PHP</h4>
<p>Vamos a comprobar que el modulo de php para apache esta bien instalado y funciona, para ello vamos a realizar lo siguiente:</p>
<ol>
<li>Iniciamos el modulo de php:</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">sudo a2enmod php7.3
</code></pre></div><ol start="2">
<li>Creamos un pequeño script en /var/www/drupal para ver si esta funcionando.</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">echo <span style="color:#e6db74">&#34;&lt;?php phpinfo(); ?&gt;&#34;</span> | sudo tee /var/www/drupal/phpinfo.php
</code></pre></div><ol start="3">
<li>Comprobamos que en la pagina <a href="http://www.francisco-drupal.org/phpinfo.php">http://www.francisco-drupal.org/phpinfo.php</a> sale este mensaje:</li>
</ol>
<p><img src="https://raw.githubusercontent.com/FranJaviMN/elementos-grado/main/Implantacion/CMS-LAMP/php-drupal.png" alt="imagen de php"></p>
<h3 id="tarea-2">Tarea 2</h3>
<p>Los dos primeros apartados de esta tarea ya las hemos realizado en la anterior tarea, ahora nos vamos a ir a la instalacion de drupal, para ello vamos a hacer es descargar drupal desde el siguiente <a href="https://www.drupal.org/download">enlace</a>.</p>
<ol>
<li>Una vez instalado lo que debemos de hacer es descargar el fichero en nuestro servidor, dentro de la carpeta de nuestro virtualhost para drupal:</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">sudo wget https://www.drupal.org/download-latest/zip
</code></pre></div><ol start="2">
<li>Ahora vamos a pasar a descomprimir el fichero y a entrar en el instalador de nuestro drupal, para ello usamos lo siguiente:</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e">#### Descomprimimos el archivo zip</span>
sudo unzip zip

<span style="color:#75715e">#### Damos los permisos de www-data a la carpeta www/* ####</span>
sudo chown -R www-data:www-data www/

<span style="color:#75715e">#### Entramos en la siguiente url ####</span>
http://www.francisco-drupal.org/drupal-9.0.7
</code></pre></div><p>Una vez hayamos entrado en el enlace anterior nos debe salir una pagina como la siguiente, mostrandonos el instalador de drupal:</p>
<p><img src="https://raw.githubusercontent.com/FranJaviMN/elementos-grado/main/Implantacion/CMS-LAMP/drupal-instalacion.png" alt="Imagen instalacion"></p>
<p>Una vez lleguemos a la zona de verificar requisitos, es posible que nos falten algunos requisitos, en mi caso me hacen falta los siguientes:</p>
<p><img src="https://raw.githubusercontent.com/FranJaviMN/elementos-grado/main/Implantacion/CMS-LAMP/drupal-requisitos.png" alt="Requisitos no cumplidos"></p>
<p>Estos requisitos debemos de solucionarlos para poder avanzar.</p>
<ul>
<li>Solucion de los requisitos de <em>dom</em>, <em>simplexml</em> y <em>xml</em>: Para la solucion de estos requisitos nos dirigimos a nuestro servidor y ahi instalamos la extension de php sobre xml:</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">sudo apt install php-xml
</code></pre></div><p>Una vez instalados los modulos de xml para php, reiniciamos el servicio de apache2 y recargamos la pagina en la que se habran eliminado las advertencias anterirores.</p>
<ul>
<li>Solucion para el requisito <em>gd</em>: Para ello debemos de instalar la extension de php llamado <em>php7.3-gd</em>:</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">sudo apt install php-gd
</code></pre></div><p>Una vez instalado, reiniciamos el servicio y recargamos la pagina, y asi ya habriamos solucionado el problema de gd.</p>
<ul>
<li>Soulucion para el requisito sobre la funcionalidad de la base de datos: Para ello debemos de instalar la siguiente extension de php llamada <em>php-mysql</em>:</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">sudo apt install php-mysql
</code></pre></div><p>Una vez instalado, reiniciamos el servicio de apache y recargamos la pagina.</p>
<p>Llegados a este punto solo nos deberian de aparecer las advertencias siguientes:</p>
<p><img src="https://raw.githubusercontent.com/FranJaviMN/elementos-grado/main/Implantacion/CMS-LAMP/advertencias-drupal.png" alt="advertencias grupal"></p>
<ul>
<li>Solucion de bibioteca unicode: Para ello solo debemos de instalar la extension de php llamada <em>php7.3-mbstring</em>:</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">sudo apt install php-mbstring
</code></pre></div><p>Una vez hecho esto, reiniciamos el servicio de apache y recargamos la pagina.</p>
<ul>
<li>Solucion para URL Limpias: Para ello debemos de iniciar el modulo de <strong>rewrite</strong> y añadir unos parametros en el fichero de <strong>drupal.conf</strong>:</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e">#### Iniciamos el modulo de rewrite ####</span>
sudo a2enmod rewrite

<span style="color:#75715e">#### Añadimos las siguientes lineas en el fichero drupal.conf ####</span>
&lt;directory /var/www/drupal&gt;
  AllowOverride All
&lt;/directory&gt;
Le estamos diciendo a nuestro fichero que si acepte el fichero .htaccess del cms drupal
</code></pre></div><p>Una vez realizado estos pasos, reiniciamos nuestros servicio de apache2 y recargamos la pagina y veremos que ya no aparece ninguna advertencia ni ningun error.</p>
<ol start="3">
<li>
<p>El siguiente paso que debemos de realizar es rellenar los campos de la base de datos que nos pide en la pagina de configurar la base de datos. Nos pediran el nombre de la base de datos, el nombre del usuario y la contraseña de dicho usuario. Solo debemos de rellenar los campos adecuadamente y tener en cuenta que el directorio donde tengamos nuestro virtualhost debe ser propiedad del usuario de apache2 llamado <strong>www-data</strong>.</p>
</li>
<li>
<p>Ahora solo debemos esperar que termine su instalacion, nos pediran que rellenemos algunos campos como el nombre del sitio y nuestro nombre, correo, etc. Una vez terminado nos aparecera la siguiente pagina cuando entremos en la direccion <em><strong><a href="http://www.francisco-drupal.org/drupal-9.0.7">http://www.francisco-drupal.org/drupal-9.0.7</a></strong></em>:</p>
</li>
</ol>
<p><img src="https://raw.githubusercontent.com/FranJaviMN/elementos-grado/main/Implantacion/CMS-LAMP/pagina-drupal.png" alt="Pagina principal drupal"></p>
<h4 id="instalar-nuevo-tema">Instalar nuevo tema</h4>
<p>Ahora que ya tenemos nuestro sitio funcionando vamos a hacer una configuración basica del sitio como por ejemplo el cambio del tema de drupal y vamos a añadir un contenido de prueba para ver que todo funciona correctamente. Para añadir contenido solo debemos de seguir los pasos que nos indica al ir a la pestaña de contenido, al igual que si cambiamos el tema.</p>
<ul>
<li>
<p>Contenido añadido: Para añadir contenido nos dirigimos al menú de administrar/contenido y una vez ahi solo debemos de ir a <em>añadir contenido</em> y seguimos los pasos que nos muestra drupal.</p>
</li>
<li>
<p>Cambiando el tema: En mi caso el tema que voy a elegir es <a href="https://www.drupal.org/project/vani">Vani</a> y para la instalacion del tema solo nos vamos a tener que ir al menu de <em>apariencia</em> y ahi seleccionamos el boton de <strong>instalar un nuevo tema</strong>. Una vez dentro copiamos la url de descarga de nuestro tema comprimido en <strong>tar.gz</strong> y lo pegamos donde dice <em>instalar desde url</em> y ya solo nos queda disfrutar de nuestro nuevo tema.</p>
</li>
</ul>
<h4 id="instalar-un-modulo-nuevo">Instalar un modulo nuevo</h4>
<p>Para ello vamos a instalar un modulo llamado <a href="https://www.drupal.org/project/addtoany">Add to any</a>, para ello nos dirigimos a la pestaña de ampliar y a la zona donde dice <strong>Instalar nuevo modulo</strong>.
Le damos y cuando estemos en la nueva pagina tenemos que copiar la url de descargar y pegarlo en la zona donde dice <strong>Instalar desde una URL</strong>.</p>
<p>Lo pegamos y una vez pegado seguimos los pasos que nos indica y elegimos el nuevo modulo en la pestaña de ampliar y lo instalamos. Ahoara solo vamos a ver el resultado del modulo.</p>
<p>Este modulo lo que hace es que, cuando creamos un nuevo articulo nos agrega los botones de las redes sociales que podemos ir configurando para que sea con nuestras redes sociales.</p>
<p><img src="https://raw.githubusercontent.com/FranJaviMN/elementos-grado/main/Implantacion/CMS-LAMP/prueba-modulo.png" alt="Prueba de modulo"></p>
<h3 id="tarea-3">Tarea 3</h3>
<ol>
<li>Realizamos la copia de seguridad: Para poder hacer una copia de seguridad en MySQL usaremos una herramienta llamada <strong>mysqldump</strong>. Este comando se incluye dentro de las utilidades del propio servidor MySQL, por lo que ya se instaló cuando instalamaos MySQL. Para poder realizar una copia de seguridad basica de la base de datos que estamos usando en nuestro cms usamos el siguiente comando:</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e">#### Copia de la base de datos basica ####</span>

mysqldump --user<span style="color:#f92672">=</span>USUARIO -p NOMBRE_DATA_BASE &gt; copia-db.sql
</code></pre></div><p>Ahora nos vamos a llevar la copia de la base de datos a nuestra maquina local, para ello lo vamos a hacer con el siguiente comando:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">scp copia-db.sql francisco@192.168.1.111:/home/francisco
</code></pre></div><p>Entonces si vemos en nuestro directorio ya tendremos nuestra copia de la base de datos de drupal.</p>
<ol start="2">
<li>Ahora vamos a crear una maquina virtual que este en una red interna con la anterior, para ello usamos el siguiente Vagrantfile:</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#75715e"># -*- mode: ruby -*-</span>
<span style="color:#75715e"># vi: set ft=ruby :</span>


$install_LAMP <span style="color:#f92672">=</span> <span style="color:#e6db74">&lt;&lt;-SCRIPT
</span><span style="color:#e6db74"></span><span style="color:#75715e">#actualizamos la lista de paquetes de la maquina</span>
sudo apt update

<span style="color:#75715e">#instalamos mariadb</span>
sudo apt install <span style="color:#f92672">-</span>y mariadb<span style="color:#f92672">-</span>server mariadb<span style="color:#f92672">-</span>client

<span style="color:#75715e">#instalamos apache2</span>
sudo apt install <span style="color:#f92672">-</span>y apache2

<span style="color:#75715e">#instalamos php </span>
sudo apt install <span style="color:#f92672">-</span>y php libapache2<span style="color:#f92672">-</span>mod<span style="color:#f92672">-</span>php
<span style="color:#66d9ef">SCRIPT</span>




<span style="color:#66d9ef">Vagrant</span><span style="color:#f92672">.</span>configure(<span style="color:#e6db74">&#34;2&#34;</span>) <span style="color:#66d9ef">do</span> <span style="color:#f92672">|</span>config<span style="color:#f92672">|</span>
  config<span style="color:#f92672">.</span>vm<span style="color:#f92672">.</span>define <span style="color:#e6db74">:maquinacms</span> <span style="color:#66d9ef">do</span> <span style="color:#f92672">|</span>maquinacms<span style="color:#f92672">|</span>
    maquinacms<span style="color:#f92672">.</span>vm<span style="color:#f92672">.</span>box <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;debian/buster64&#34;</span>
    maquinacms<span style="color:#f92672">.</span>vm<span style="color:#f92672">.</span>hostname <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;maquinacms&#34;</span>
    maquinacms<span style="color:#f92672">.</span>vm<span style="color:#f92672">.</span>network <span style="color:#e6db74">:private_network</span>, <span style="color:#e6db74">ip</span>: <span style="color:#e6db74">&#34;192.168.100.100&#34;</span>, <span style="color:#e6db74">virtualbox__intnet</span>: <span style="color:#e6db74">&#34;lan1&#34;</span>
    maquinacms<span style="color:#f92672">.</span>vm<span style="color:#f92672">.</span>network <span style="color:#e6db74">:private_network</span>, <span style="color:#e6db74">ip</span>: <span style="color:#e6db74">&#34;192.168.200.100&#34;</span>
    maquinacms<span style="color:#f92672">.</span>vm<span style="color:#f92672">.</span>provision <span style="color:#e6db74">&#34;shell&#34;</span>, <span style="color:#e6db74">inline</span>: $install_LAMP

  <span style="color:#66d9ef">end</span>
  config<span style="color:#f92672">.</span>vm<span style="color:#f92672">.</span>define <span style="color:#e6db74">:maquinadb</span> <span style="color:#66d9ef">do</span> <span style="color:#f92672">|</span>maquinadb<span style="color:#f92672">|</span>
    maquinadb<span style="color:#f92672">.</span>vm<span style="color:#f92672">.</span>box <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;debian/buster64&#34;</span>
    maquinadb<span style="color:#f92672">.</span>vm<span style="color:#f92672">.</span>hostname <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;maquinadb&#34;</span>
    maquinadb<span style="color:#f92672">.</span>vm<span style="color:#f92672">.</span>network <span style="color:#e6db74">:private_network</span>, <span style="color:#e6db74">ip</span>: <span style="color:#e6db74">&#34;192.168.100.101&#34;</span>, <span style="color:#e6db74">virtualbox__intnet</span>: <span style="color:#e6db74">&#34;lan1&#34;</span>
    maquinadb<span style="color:#f92672">.</span>vm<span style="color:#f92672">.</span>provision <span style="color:#e6db74">&#34;file&#34;</span>, <span style="color:#e6db74">source</span>: <span style="color:#e6db74">&#34;/home/francisco/copia-db.sql&#34;</span>, <span style="color:#e6db74">destination</span>: <span style="color:#e6db74">&#34;/home/vagrant/copia-db.sql&#34;</span>
  <span style="color:#66d9ef">end</span>
<span style="color:#66d9ef">end</span>

</code></pre></div><ol start="3">
<li>Ahora debemos de instalar en la maquina <em><strong>maquinadb</strong></em> la base de datos, en este caso vamos a instalar MySQL y crear un usuario:</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e">#### Instalamos la base de datos MySQL ####</span>
sudo apt install -y mariadb-server mariadb-client php-mysql

<span style="color:#75715e">#### Entramos como root en mariadb ####</span>
sudo mysql -u root -p

<span style="color:#75715e">#### Creamos la base de datos ####</span>
CREATE DATABASE nombredb;

<span style="color:#75715e">#### Creamos el usuario ####</span>
CREATE USER <span style="color:#e6db74">&#39;nombreuser&#39;</span>@<span style="color:#e6db74">&#39;localhost&#39;</span> IDENTIFIED BY <span style="color:#e6db74">&#39;contraseñauser&#39;</span>;

<span style="color:#75715e">#### Le damos todos los privilegios al nuevo usuario sobre la nueva base de datos ####</span>
GRANT ALL PRIVILEGES ON nombredb.* to <span style="color:#e6db74">&#39;nombreuser&#39;</span>@<span style="color:#e6db74">&#39;localhost&#39;</span>;

Salimos de mysql y restauramos la copia de la base de datos

<span style="color:#75715e">#### Recuperamos la copia de la base de datos ####</span>
mysql --user<span style="color:#f92672">=</span>USUARIO --password<span style="color:#f92672">=</span>CONTRASEÑA nombredb &lt; copia-db.sql
</code></pre></div><p>Ahora nos dirigimos a la maquina de maquinacms y en ella desinstalamos mariadb:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">sudo apt purge mariadb-client-10.3 mariadb-server-10.3
</code></pre></div><p>Una vez desinstalado nos saldra el siguiente error en la pagina de drupal:</p>
<p><img src="https://raw.githubusercontent.com/FranJaviMN/elementos-grado/main/Implantacion/CMS-LAMP/falta-db.png" alt="error drupal"></p>
<p>A partir de aqui no me ha funcionado el cambio de base de datos.</p>
<h3 id="tarea-4">Tarea 4</h3>
<p>En mi caso voy a usar como cms extra a instalar voy a usar anchor, que es un liviano sistema de creacion de blogs.</p>
<p>Para ello vamos a realizar los siguientes pasos:</p>
<ol>
<li>Cambiamos el documentroot a <em><strong>/var/www</strong></em>, cambiamos el nombre de drupal.conf y creamos una carpeta en <em><strong>/var/www</strong></em>:</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e">#### Cambiamos el nombre de drupal.conf y lo volvemos a activar ####</span>
sudo mv drupal.conf ./cms.conf
sudo a2ensite cms.conf

<span style="color:#75715e">#### Contenido de cms.conf ####</span>
&lt;VirtualHost *:80&gt;
  ServerName www.francisco-drupal.org
  ServerAdmin webmaster@localhost
  DocumentRoot /var/www
  ErrorLog <span style="color:#e6db74">${</span>APACHE_LOG_DIR<span style="color:#e6db74">}</span>/error.log
  CustomLog <span style="color:#e6db74">${</span>APACHE_LOG_DIR<span style="color:#e6db74">}</span>/access.log combined
  &lt;directory /var/www&gt;
    AllowOverride All
  &lt;/directory&gt;
&lt;/VirtualHost&gt;

<span style="color:#75715e">#### Cramos la carpeta anchor ####</span>
sudo mkdir /var/www/anchor
</code></pre></div><ol start="2">
<li>Creamos una nueva base de datos en la cual vamos a guardar nuestro cms:</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e">####Creamos la nueva base de datos ####</span>
CREATE DATABASE anchor;

<span style="color:#75715e">#### Le damos todos los privilegios al nuevo usuario sobre la nueva base de datos ####</span>
GRANT ALL PRIVILEGES ON anchor.* to <span style="color:#e6db74">&#39;nombreuser&#39;</span>@<span style="color:#e6db74">&#39;localhost&#39;</span>;

<span style="color:#75715e">#### Salimos de mariadb ####</span>
FLUSH PRIVILEGES;
quit
</code></pre></div><ol start="3">
<li>Descargamos nuestro cms desde <a href="https://github.com/anchorcms/anchor-cms/releases">aqui</a>:</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e">#### Dentro de /var/www/anchor ####</span>
sudo wget https://github.com/anchorcms/anchor-cms/releases/download/0.12.7/anchor-cms-0.12.7-bundled.zip

<span style="color:#75715e">#### Descomprimimos el fichero ####</span>

sudo unzip anchor-cms-0.12.7-bundled.zip
</code></pre></div><ol start="4">
<li>Reiniciamos el servicio de apache y entramos en la url <a href="http://www.francisco-drupal.org/anchor/anchor-cms-0.12.7:">www.francisco-drupal.org/anchor/anchor-cms-0.12.7:</a></li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e">#### Reiniciamos apache2 ####</span>
sudo systemctl reload apache2.service
</code></pre></div><p><img src="https://raw.githubusercontent.com/FranJaviMN/elementos-grado/main/Implantacion/CMS-LAMP/anchor-cms.png" alt="imagen de instalador de anchor"></p>
<ol start="5">
<li>Iniciamos la instalacion de anchor y seguimos sus pasos, en este caso no nos pedira nada en especial, solo el nombre de nuestro sitio, una descripcion y el path que queremos usar. Este ultimo es recomendable cambiarlo.</li>
</ol>

  
  </div>
</article>


    <footer id="footer">
  <div class="footer-left">
    Copyright  &copy; 2021  Francisco Javier Martín Núñez 
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
        <li><a href="/">Home</a></li>
         
        <li><a href="/sistemas">Sistemas</a></li>
         
        <li><a href="/seguridad">Seguridad</a></li>
         
        <li><a href="/servicios">Servicios</a></li>
         
        <li><a href="/implantacion">Implantacion</a></li>
         
        <li><a href="/bbdd">BBDD</a></li>
        
      </ul>
    </nav>
  </div>
</footer>


  </div>
  
</body>

<link rel="stylesheet" href=/lib/font-awesome/css/all.min.css>
<script src=/lib/jquery/jquery.min.js></script>
<script src=/js/main.js></script>
</html>
