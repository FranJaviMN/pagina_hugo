<!DOCTYPE html>
<html lang="es-ES">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title> Practica Cifrado | Blog</title>
  <meta name="description" content="En esta página estatica vamos a guardar algunos de los trabajos que vaya realizando a lo largo del curso de 2ºASIR en el instituto I.E.S. Gonzalo Nazareno.">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="robots" content="all,follow">
  <meta name="googlebot" content="index,follow,snippet,archive">
  <meta property="og:title" content="Practica Cifrado" />
<meta property="og:description" content="Cifrado asimétrico con gpg y openssl En esta practica sobre el cifrado asimétrico con gpg y openssl vamos a realizar las siguientes tareas:
  Tarea 1: Generación de claves
 Genera un par de claves (pública y privada). ¿En que directorio se guarda las claves de un usuario? Lista las claves públicas que tienes en tu almacén de claves. Explica los distintos datos que nos muestra. ¿Cómo deberías haber generado las claves para indicar, por ejemplo, que tenga un 1 mes de validez?" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://franjavimn.onrender.com/seguridad/practica-cifrado/" />
<meta property="article:published_time" content="2020-10-07T18:57:04+02:00" />
<meta property="article:modified_time" content="2020-10-07T18:57:04+02:00" />

  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Practica Cifrado"/>
<meta name="twitter:description" content="Cifrado asimétrico con gpg y openssl En esta practica sobre el cifrado asimétrico con gpg y openssl vamos a realizar las siguientes tareas:
  Tarea 1: Generación de claves
 Genera un par de claves (pública y privada). ¿En que directorio se guarda las claves de un usuario? Lista las claves públicas que tienes en tu almacén de claves. Explica los distintos datos que nos muestra. ¿Cómo deberías haber generado las claves para indicar, por ejemplo, que tenga un 1 mes de validez?"/>

  
  
    
  
  
  <link rel="stylesheet" href="https://franjavimn.onrender.com/css/style-white.css">
  
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  

  
<link rel="icon" type="image/png" href="https://franjavimn.onrender.com/images/favicon.ico" />

  
</head>
<body class="max-width mx-auto px3 ltr">
  <div class="content index py4">

    <header id="header">
  <a href="https://franjavimn.onrender.com">
  
    <div id="logo" style="background-image: url(https://franjavimn.onrender.com/images/logo.png)"></div>
  
  <div id="title">
    <h1>Blog</h1>
  </div>
  </a>
  <div id="nav">
    <ul>
      <li class="icon">
        <a href="#"><i class="fas fa-bars fa-2x"></i></a>
      </li>
       
        <li><a href="/">Home</a></li>
       
        <li><a href="/sistemas">Sistemas</a></li>
       
        <li><a href="/seguridad">Seguridad</a></li>
       
        <li><a href="/servicios">Servicios</a></li>
       
        <li><a href="/implantacion">Implantacion</a></li>
       
        <li><a href="/bbdd">BBDD</a></li>
       
        <li><a href="/hlc">HLC</a></li>
      
    </ul>
  </div>
</header>
  

    
<article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <div class="content" itemprop="articleBody">
  
    <h1 id="cifrado-asimétrico-con-gpg-y-openssl">Cifrado asimétrico con gpg y openssl</h1>
<p>En esta practica sobre el cifrado asimétrico con gpg y openssl vamos a realizar las siguientes tareas:</p>
<ul>
<li>
<p>Tarea 1: Generación de claves</p>
<ol>
<li>Genera un par de claves (pública y privada). ¿En que directorio se guarda las claves de un usuario?</li>
<li>Lista las claves públicas que tienes en tu almacén de claves. Explica los distintos datos que nos muestra. ¿Cómo deberías haber generado las claves para indicar, por ejemplo, que tenga un 1 mes de validez?</li>
<li>las claves privadas de tu almacén de claves.</li>
</ol>
</li>
<li>
<p>Tarea 2: Importar / exportar clave pública</p>
<ol>
<li>Exporta tu clave pública en formato ASCII y guardalo en un archivo nombre_apellido.asc y envíalo al compañero con el que vas a hacer esta práctica.</li>
<li>Importa las claves públicas recibidas de vuestro compañero.</li>
<li>Comprueba que las claves se han incluido correctamente en vuestro keyring.</li>
</ol>
</li>
<li>
<p>Tarea 3: Cifrado asimétrico con claves públicas</p>
<ol>
<li>Cifraremos un archivo cualquiera y lo remitiremos por email a uno de nuestros compañeros que nos proporcionó su clave pública.</li>
<li>compañero, a su vez, nos remitirá un archivo cifrado para que nosotros lo descifremos.</li>
<li>Tanto nosotros como nuestro compañero comprobaremos que hemos podido descifrar los mensajes recibidos respectivamente.</li>
<li>Por último, enviaremos el documento cifrado a alguien que no estaba en la lista de destinatarios y comprobaremos que este usuario no podrá descifrar este archivo.</li>
<li>Para terminar, indica los comandos necesarios para borrar las claves públicas y privadas que posees.</li>
</ol>
</li>
<li>
<p>Tarea 4: Exportar clave a un servidor público de claves PGP</p>
<ol>
<li>Genera la clave de revocación de tu clave pública para utilizarla en caso de que haya problemas.</li>
<li>Exporta tu clave pública al servidor <em>pgp.rediris.es</em></li>
<li>Borra la clave pública de alguno de tus compañeros de clase e impórtala ahora del servidor público de rediris.</li>
</ol>
</li>
<li>
<p>Tarea 5: Cifrado asimétrico con openssl</p>
<ol>
<li>Genera un par de claves (pública y privada).</li>
<li>Envía tu clave pública a un compañero.</li>
<li>Utilizando la clave pública cifra un fichero de texto y envíalo a tu compañero.</li>
<li>Tu compañero te ha mandado un fichero cifrado, muestra el proceso para el descifrado.</li>
</ol>
</li>
</ul>
<h2 id="tarea-1">Tarea 1</h2>
<p>Lo primero que vamos a hacer es crearnos nuestro par de claves, para ello debemos usar el siguiente comando:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">gpg --gen-key
</code></pre></div><p>Una vez generada nuestro par de claves nos pedirán unas credenciales como son el nombre y el correo electrónico con una frase de paso, la cual podemos ponerla o no, en este caso no la pondremos. Estas claves se guardan en el directorio <em><strong>/home/francisco/.gnupg/</strong></em></p>
<p>Si quisiéramos ver la lista de claves que tenemos en nuestro sistema solo debemos de ejecutar el siguiente comando:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e">#### Ver lista de claves públicas ####</span>
gpg --list-keys

<span style="color:#75715e">#### Ver lista de claves privadas ####</span>
gpg --list-secret-keys
</code></pre></div><p>Al ejecutar el comando anterior veremos que nos aparece en pantalla información como son el dia de creación de la clave publica y su fecha de caducidad, el uuid de nuestra clave publica, las credenciales de esa clave publica y la fecha de creación y validez de la subclave pública.</p>
<p>Si nosotros quisiéramos hacer que esta clave que hemos creado caduque en un periodo de un mes solo debemos de localizar el uuid de esta clave mediante el listado de claves, una vez lo tengamos debemos de escribir en la terminal el siguiente comando:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e">#### Entrar en prompt de gpg ####</span>

gpg --edit-key <span style="color:#f92672">(</span>uuid de la clave publica<span style="color:#f92672">)</span>
</code></pre></div><p>De esta forma nos abrira un prompt de gpg en el cual debemos de seleccionar nuestra clave publica, para ello usamos el comando <strong>key 0</strong> y veremos que tendremos seleccionada la clave publica, una vez hecho esto solo debemos escribir <strong>expire</strong> y nos mostrara las siguientes opciones para poder hacer que solo tenga un mes de validez:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">gpg&gt; expire
Cambiando caducidad de clave primaria.
Por favor, especifique el período de validez de la clave.
         0 <span style="color:#f92672">=</span> la clave nunca caduca
      &lt;n&gt;  <span style="color:#f92672">=</span> la clave caduca en n días
      &lt;n&gt;w <span style="color:#f92672">=</span> la clave caduca en n semanas
      &lt;n&gt;m <span style="color:#f92672">=</span> la clave caduca en n meses
      &lt;n&gt;y <span style="color:#f92672">=</span> la clave caduca en n años
¿Validez de la clave <span style="color:#f92672">(</span>0<span style="color:#f92672">)</span>? 1m
La clave caduca jue <span style="color:#ae81ff">12</span> nov <span style="color:#ae81ff">2020</span> 16:50:19 CET
¿Es correcto? <span style="color:#f92672">(</span>s/n<span style="color:#f92672">)</span> s

</code></pre></div><p>De esta forma hemos cambiado la validez de la clave publica a 1 mes, pero tambien debemos de hacer el mismo proceso con la subclave publica, para ello primero la seleccionamos con el comando <strong>key 1</strong> y una vez seleccionada solo debemos de realizar el mismo proceso que con la clave publica, primero escibimos <strong>expire</strong> y luego seleccionamos el tiempo de validez.</p>
<h2 id="tarea-2">Tarea 2</h2>
<p>Para enviar archivos cifrados a otras personas, necesitamos disponer de sus claves públicas. De la misma manera, si queremos que cierta persona pueda enviarnos datos cifrados, esta necesita conocer nuestra clave pública. Para ello, podemos hacérsela llegar por email por ejemplo. Cuando recibamos una clave pública de otra persona, esta deberemos incluirla en nuestro keyring o anillo de claves, que es el lugar donde se almacenan todas las claves públicas de las que disponemos.</p>
<p>Si nosotros queremos exportar nuestra clave publica solo debemos de realizar el siguiente comando:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e">#### Exportar en formato binario ####</span>

gpg --export <span style="color:#e6db74">&#34;Claves_pruebas&#34;</span> &gt; francisco_martin.asc

<span style="color:#75715e">#### Exportar en formato ascii ####</span>

gpg --armor --export <span style="color:#e6db74">&#34;Claves_pruebas&#34;</span> &gt; francisco_martin.asc
</code></pre></div><p>Cuando hayamos recibido la clave publica de nuestro compañero debemos de importar esas claves a nuestro equipo, para ello vamos a usar el siguiente comando:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e">#### Importar una clave publica ####</span>

gpg --import nombre_clave_publica.key

<span style="color:#75715e">#### Importar una clave privada ####</span>

gpg --allow-secret-key-import --import nombre_clave_privada.key
</code></pre></div><p>Una vez importada la clave de nuestro compañero vamos a ver que se haya añadido correctamente, para ello listamos las claves publicas que tenemos.</p>
<h2 id="tarea-3">Tarea 3</h2>
<p>Tras realizar el ejercicio anterior, podemos enviar ya documentos cifrados utilizando la clave pública de los destinatarios del mensaje.</p>
<p>Primero lo que debemos de hacer es cifrar un mensaje para que nuestro compañero con nuestra clave publica que nosotros le hemos proporcionado pueda descifrarlo, para ello usamos el siguiente listado de comandos:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e">#### Creamos el fichero de prueba ####</span>

nano prueba1.txt -&gt; Escribimos dentro algo para poder hacer la prueba

<span style="color:#75715e">#### Ciframos el fichero de prueba con la clave publica de nuestro compañero ####</span>

gpg -e -r nombre_clave_compañero prueba1.txt

donde:
-e: le indicamos a gpg que vamos a encriptar un fichero
-r: Indicamos la clave publica con la que vamos a encriptar, en este caso la clave publica de nuestro compañero
</code></pre></div><p>De esta forma nos va a generar un fichero llamado <em><strong>prueba1.txt.gpg</strong></em> que es el fichero que tenemos que enviarle a nuestro compañero y nosotros a su vez tenemos que recibir un fichero como el que hemos enviado pero esta vez el fichero que hemos recibido esta cifrado con nuestra clave publica y tendremos que desemcriptar con nuestra clave privada, para ello usamos el siguiente comando:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e">#### Desencriptamos el fichero que hemos recibido ####</span>

gpg -d prueba1.txt.gpg
...
gpg: cifrado con clave de <span style="color:#ae81ff">3072</span> bits RSA, ID F1274AC86BAC6840, creada el 2020-10-13
      <span style="color:#e6db74">&#34;Claves_pruebas&#34;</span>
hola esto es una prueba

<span style="color:#75715e">#### Si queremos redireccionar el resultado a un fichero ####</span>

gpg -d prueba1.txt.gpg &gt; resultado.txt
</code></pre></div><p>Una vez hecho esto el contenido del fichero cifrado lo tendremos, en este caso, en el fichero <em>resultado.txt</em>. Ahora bien, si queremos ver que de verdad funciona el cifrado le vamos a enviar a otro compañero el mismo fichero cifrado que hemos enviado al compañero que tiene la clave privada para descifrarlo. Cuando el compañero que no tiene la clave privada para poder desencriptar el fichero intente desencriptarlo le aparecerá el siguiente error:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">gpg -d prueba1.txt.gpg &gt; resultado.txt
...
gpg: cifrado con clave RSA, ID F1274AC86BAC6840
gpg: descifrado fallido: No secret key
</code></pre></div><p>Ya que hemos realizado las correspondientes pruebas con la clave publica de nuestro compañero vamos a borrarla de nuestro llavero de claves, para ello vamos a usar el siguiente comando:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e">#### Borrar una clave privada ####</span>

gpg --delete-secret-key nombre_claves

<span style="color:#75715e">#### Borrar clave publica ####</span>

gpg --delete-key nombre_claves

Tenemos que tener en cuenta que si queremos borrar un par de claves primero debemos de borrar la clave privada y
luego la clave publica
</code></pre></div><h2 id="tarea-4">Tarea 4</h2>
<p>Para distribuir las claves públicas es mucho más habitual utilizar un servidor específico para distribuirlas, que permite a los clientes añadir las claves públicas a sus anillos de forma mucho más sencilla.</p>
<p>Para ello voy a usar la clave publica de mi par de claves que tiene como nombre <em>Francisco Javier Martín Núñez</em>, esa clave de revocacion de nuestra clave publica la vamos a guardar en un fichero llamado <em><strong>revocacion.asc</strong></em>, para poder hacer esto debemos de realizar el siguiente comando:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e">#### Creacion de clave de revocacion ####</span>

gpg --gen-revoke <span style="color:#e6db74">&#34;Francisco Javier Martín Núñez&#34;</span> &gt; revocacion.asc

sec  rsa3072/BEAECEA4DC2F7A96 2020-10-07 Francisco Javier Martín Núñez &lt;franjaviermn17100@gmail.com&gt;

¿Crear un certificado de revocación para esta clave? <span style="color:#f92672">(</span>s/N<span style="color:#f92672">)</span> s
Por favor elija una razón para la revocación:
  0 <span style="color:#f92672">=</span> No se dio ninguna razón
  1 <span style="color:#f92672">=</span> La clave ha sido comprometida
  2 <span style="color:#f92672">=</span> La clave ha sido reemplazada
  3 <span style="color:#f92672">=</span> La clave ya no está en uso
  Q <span style="color:#f92672">=</span> Cancelar
<span style="color:#f92672">(</span>Probablemente quería seleccionar <span style="color:#ae81ff">1</span> aquí<span style="color:#f92672">)</span>
¿Su decisión? <span style="color:#ae81ff">0</span>
Introduzca una descripción opcional; acábela con una línea vacía:
&gt; Pruebas para seguridad
&gt; 
Razón para la revocación: No se dio ninguna razón
Pruebas para seguridad
¿Es correcto? <span style="color:#f92672">(</span>s/N<span style="color:#f92672">)</span> s
se fuerza salida con armadura ASCII.
Certificado de revocación creado.
</code></pre></div><p>De esta forma tendremos nuestra clave de revocacion en el fichero <em><strong>revocacion.asc</strong></em>. Ahora que tenemos la clave de revocacion vamos a exportar nuestra clave publica a el sevidor de claves <em><strong>pgp.rediris.es</strong></em> de la siguiente forma:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">gpg --send-keys --keyserver pgp.rediris.es <span style="color:#f92672">(</span>UUID de la clave publica<span style="color:#f92672">)</span>
</code></pre></div><p>Ahora vamos a importar desde el servidor la clave publica de nuestro compañero, para ello vamos a usar el siguiente comando:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">gpg --search-key --keyserver pgp.rediris.es <span style="color:#f92672">(</span>identificador de la clave publica<span style="color:#f92672">)</span>
</code></pre></div><h2 id="tarea-5">Tarea 5</h2>
<p>En esta ocasión vamos a cifrar nuestros ficheros de forma asimétrica utilizando la herramienta openssl. Para ello nos vamos a generar nuestro par de claves, para ello vamos a usar los siguientes comandos:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e">#### Generar clave pública y privada en formato PEM sin contraseña ####</span>

openssl genrsa -out claves.pem <span style="color:#ae81ff">2048</span>

<span style="color:#75715e">#### Generar clave pública y privada en formato PEM con contraseña ####</span>

openssl genrsa -aes128 -out claves.pem <span style="color:#ae81ff">2048</span>

<span style="color:#75715e">#### Obtención o separación de la clave pública en formato PEM ####</span>

openssl rsa -in claves.pem -pubout -out publica.public.pem
</code></pre></div><p>Una vez hecho esto, tenemos que separar nuestras claves y obtener la clave publica que es la que le vamos a enviar a nuestro compañero, en este caso, nuestra clave publica llamada <em><strong>publica.public.pem</strong></em>.</p>
<p>Una vez hecho esto vamos a cifrar algun fichero con nuestra clave publica, para ello vamos a usar el siguiente comando:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e">#### Paso 1, generar clave aleatoria ####</span>

openssl rand -base64 <span style="color:#ae81ff">48</span> -out key.txt

<span style="color:#75715e">#### Paso 2, cifrar el archivo con la clave simétrica ####</span>

openssl enc -aes-256-cbc -pass file:key.txt -in archivoSINcifrar -out archivoCIFRADO.enc

<span style="color:#75715e">#### Paso 3, cifrar la clave generada en el paso 1 con la llave pública ####</span>

openssl rsautl -encrypt -in key.txt -out key.enc -inkey publica.public.pem -pubin

Donde:
    -enc -aes-256-cbc: Tipo de cifrado simétrico.
    -pass file:key.txt: La clave con la que cifrar el archivo.
    -in: Fichero de entrada.
    -out: Fichero de salida.
    -rsautl: Indica que vamos a usar RSA para firmar, verificar, cifrar o descifrar.
    -encrypt: Encriptar el fichero de entrada con una llave RSA pública.
    -inkey: Llave con la que cifrar
    -pubin: Indica que vamos a firmar con una llave pública.
</code></pre></div><p>Y si queremos desemcriptar el fichero que hemos encriptado:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e">#### Paso 1, desciframos la clave generada en 1 y cifrada con la llave pública en 3 ####</span>

openssl rsautl -decrypt -inkey ./claves.pem -in key.enc -out key.txt

<span style="color:#75715e">#### Paso 2, Descifrar el archivo con la clave ####</span>

openssl enc -aes-256-cbc -d -pass file:key.txt -in archivoCIFRADO.encrypted -out archivoSINcifrar

Donde:
    -d: Descifra los datos de entrada.
</code></pre></div>
  
  </div>
</article>


    <footer id="footer">
  <div class="footer-left">
    Copyright  &copy; 2021  Francisco Javier Martín Núñez 
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
        <li><a href="/">Home</a></li>
         
        <li><a href="/sistemas">Sistemas</a></li>
         
        <li><a href="/seguridad">Seguridad</a></li>
         
        <li><a href="/servicios">Servicios</a></li>
         
        <li><a href="/implantacion">Implantacion</a></li>
         
        <li><a href="/bbdd">BBDD</a></li>
         
        <li><a href="/hlc">HLC</a></li>
        
      </ul>
    </nav>
  </div>
</footer>


  </div>
  
</body>

<link rel="stylesheet" href=/lib/font-awesome/css/all.min.css>
<script src=/lib/jquery/jquery.min.js></script>
<script src=/js/main.js></script>
</html>
